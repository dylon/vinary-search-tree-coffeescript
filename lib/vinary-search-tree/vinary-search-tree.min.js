/*

The MIT License (MIT)

Copyright (c) 2014 Dylon Edwards

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
*/
(function(){var k;k="undefined"!==typeof exports?exports:"undefined"!==typeof window?window:this;k.vst||(k.vst={});k.vst.comparators={c_number:function(h,d){return h-d},c_string_case_sensitive:function(h,d){return h.localeCompare(d)},c_string_case_insensitive:function(h,d){return h.toLowerCase().localeCompare(d.toLowerCase())}}}).call(this);
(function(){var k;k="undefined"!==typeof exports?exports:"undefined"!==typeof window?window:this;k.vst||(k.vst={});k.vst.metrics={m_number:function(h,d){return Math.abs(h-d)}}}).call(this);
(function(){var k,h,d,f,p=[].slice;h="undefined"!==typeof window?window:"undefined"!==typeof exports?exports:this;k=function(b,e){if(!d.is_boolean(b))throw Error("Expected truth="+b+" to be a boolean");if(!d.is_undefined(e)&&!d.is_string(e))throw Error("Expected message="+e+" to be a string");if(!1===b){if(e)throw Error("Assertion error: "+e);throw Error("Assertion error");}return!0};d=f={tautology:function(){return!0},contradiction:function(){return!1},is_number:function(b){return"number"===typeof b},
is_negative_number:function(b){return d.is_number(b)&&0>b},is_non_positive_number:function(b){return d.is_number(b)&&0>=b},is_non_negative_number:function(b){return d.is_number(b)&&0<=b},is_positive_number:function(b){return d.is_number(b)&&0<b},is_boolean:function(b){return"boolean"===typeof b},is_string:function(b){return"string"===typeof b},is_function:function(b){return"function"===typeof b},is_constructor:function(b){return d.is_function(b)&&d.is_object(b.prototype)},is_null:function(b){return null===
b},is_undefined:function(b){return void 0===b},is_defined:function(b){return!d.is_undefined(b)&&!d.is_null(b)},is_object:function(b){return"object"===typeof b&&!d.is_null(b)},is_array:function(b){return d.is_object(b)&&d.is_non_negative_number(b.length)},has_arity:function(b){k(d.is_non_negative_number(b));return function(e){return e.length===b}},is_instance:function(b){k(d.is_function(b));return function(e){return e instanceof b}},is_type:function(b){k(d.is_function(b));return function(e){return d.is_function(e)&&
e.prototype instanceof b}},is_bounded:function(b,e){k(d.is_number(b)&&d.is_number(e));return function(g){return d.is_number(g)&&b<=g&&g<=e}},is_lt:function(b){k(d.is_number(b));return function(e){return d.is_number(e)&&e<b}},is_lte:function(b){k(d.is_number(b));return function(e){return d.is_number(e)&&e<=b}},is_eq:function(b){k(d.is_number(b));return function(e){return d.is_number(e)&&e===b}},is_gte:function(b){k(d.is_number(b));return function(e){return d.is_number(e)&&e>=b}},is_gt:function(b){k(d.is_number(b));
return function(e){return d.is_number(e)&&e>b}},is_equal:function(b){return function(e){return e===b}},there_exists:function(b){k(d.is_function(b));return function(e){var g,q,m;k(d.is_array(e));q=0;for(m=e.length;q<m;q++)if(g=e[q],!0===b.call(this,g))return!0;return!1}},for_all:function(b){k(d.is_function(b));return function(e){var g,q,m;k(d.is_array(e));q=0;for(m=e.length;q<m;q++)if(g=e[q],!1===b.call(this,g))return!1;return!0}},disjoin:function(){var b,e,g;e=1<=arguments.length?p.call(arguments,
0):[];switch(e.length){case 0:return d.tautology;case 1:return b=e[0],function(e){return b.call(this,e)};case 2:return b=e[0],g=e[1],function(e){return b.call(this,e)||g.call(this,e)};default:return b=e[0],e=2<=e.length?p.call(e,1):[],g=d.disjoin.apply(null,e),function(e){return b.call(this,e)||g.call(this,e)}}},conjoin:function(){var b,e,g;e=1<=arguments.length?p.call(arguments,0):[];switch(e.length){case 0:return d.tautology;case 1:return b=e[0],function(e){return b.call(this,e)};case 2:return b=
e[0],g=e[1],function(e){return b.call(this,e)&&g.call(this,e)};default:return b=e[0],e=2<=e.length?p.call(e,1):[],g=d.conjoin.apply(null,e),function(e){return b.call(this,e)&&g.call(this,e)}}}};h.vst||(h.vst={});h.vst.predicates=f}).call(this);
(function(){var k,h,d,f,p=[].slice,b={}.hasOwnProperty;"undefined"!==typeof exports?(d=exports,f=require("./predicates").vst.predicates):"undefined"!==typeof window?(d=window,f=window.vst.predicates):(d=this,f=this.vst.predicates);k=h={assert:function(b,g){if(!f.is_boolean(b))throw Error("Expected truth="+k.to_string(b)+" to be a boolean");if(!f.is_undefined(g)&&!f.is_string(g))throw Error("Expected message="+k.to_string(g)+" to be a string");if(!1===b){if(f.is_undefined(g))throw Error("Assertion failed");
throw Error("Assertion failed: "+g);}},proxy:function(b,g){return function(){var d;d=1<=arguments.length?p.call(arguments,0):[];return b.apply(g,d)}},to_string:function(e){var g,d,m,a;if(f.is_null(e))return"null";if(f.is_undefined(e))return"undefined";if(f.is_array(e)){d=[];m=0;for(a=e.length;m<a;m++)g=e[m],d.push(k.to_string(g));return"["+d.join(", ")+"]"}if(f.is_object(e)){if(e.toString===Object.prototype.toString){g=[];for(d in e)b.call(e,d)&&(m=e[d],g.push(d+": "+k.to_string(m)));return"{"+g.join(", ")+
"}"}return e.toString()}return f.is_string(e)?'"'+e+'"':e.toString()}};d.vst||(d.vst={});d.vst.functions=h}).call(this);
(function(){var k,h,d,f,p,b,e,g,q={}.hasOwnProperty;"undefined"!==typeof exports?(d=exports,b=require("./predicates").vst.predicates,h=require("./functions").vst.functions):"undefined"!==typeof window?(d=window,b=window.vst.predicates,h=window.vst.functions):(d=this,b=this.vst.predicates,h=this.vst.functions);p=function(b,a){return function(c,l){if(!b.call(c,l))throw Error(""+h.to_string(l)+" is invalid for "+c.constructor.name+"."+a);return l}};e=function(e,a){return b.is_function(e[a])?e[a]():e[a]};
g=function(e){var a,c,l,t;if(e instanceof k)return e.validate();if(b.is_array(e)){t=[];c=0;for(l=e.length;c<l;c++)a=e[c],t.push(g(a));return t}if(b.is_object(e)){l=[];for(a in e)q.call(e,a)&&(c=e[a],l.push(g(c)));return l}return!0};k=function(){function d(a){var c,l,e,g,s,r,f,k;if(!b.is_array(a))throw Error("Expected "+h.to_string(a)+" to be an array");l={};r=0;for(f=a.length;r<f;r++)if(s=a[r],void 0!==s){if(!(b.is_function(s)&&s.prototype instanceof d&&this instanceof s))throw Error(""+s.name+" must be of type Entity");
if(s.__ABSTRACT_METHODS__)for(c in k=s.__ABSTRACT_METHODS__,k)q.call(k,c)&&(g=k[c],c[c]={type:s,attrs:g});s=s.__INITIALIZERS__;for(e in s)q.call(s,e)&&(g=s[e],this[e]=g.call(this,e))}this.__TYPE__=a=a[a.length-1];for(c in l)q.call(l,c)&&(e=l[c],a=e.type,e=e.attrs,e=e.arity,h.assert(b.is_method(this[c]),"Expected "+to_string(this)+" to implemented "+a.name+"::"+c),b.is_defined(e)&&h.assert(this[c].length>=e,"Expected "+to_string(h)+" to have an arity of at least "+e))}d.def_property=function(a,c,l){var e,
g,d,r,m,f,q,k;m=l.initial_value;d=l.get;r=l.init;f=l.is_valid;q=l.set;l=l.stringify;if(!b.is_function(a))throw Error(""+c+".ctor="+h.to_string(a)+" must be a function");if(!b.is_string(c))throw Error("property="+h.to_string(c)+" must be a string");if(!(b.is_function(f)&&1>=f.length))throw Error(""+c+".is_valid="+h.to_string(f)+" must be a function of arity <= 1");if(!(b.is_undefined(d)||b.is_function(d)&&1>=d.length))throw Error(""+c+".get="+h.to_string(d)+" must not be specified or must be a function of arity <= 1");
if(!(b.is_undefined(q)||b.is_function(q)&&1<=(k=q.length)&&2>=k))throw Error(""+c+".set="+h.to_string(q)+" must not be specified or must be a function of arity of 1 or 2");if(!(b.is_undefined(r)||b.is_function(r)&&1>=r.length))throw Error(""+c+".init="+h.to_string(r)+" must not be specified or must be a function of arity <= 1");if(!b.is_undefined(m)&&!f(m))throw Error(""+h.to_string(m)+" is invalid for "+c);if(!b.is_undefined(l)&&!b.is_boolean(l))throw Error("Expected "+c+".stringify="+h.to_string(l)+
" to be a boolean");d||(d=function(a){return this[a]});q||(q=function(a,c){return this[a]=c});1===q.length&&(q=function(a){return function(c,b){return a(b)}}(q));g="__"+c;e=p(f,c);b.is_undefined(m)||(a.prototype[g]=m);a.__INITIALIZERS__||(a.__INITIALIZERS__={});a.prototype[c]=function(a){var l;if(b.is_undefined(a)){this.__GET_CALLSTACK_SIZE__||(this.__GET_CALLSTACK_SIZE__={});(l=this.__GET_CALLSTACK_SIZE__)[c]||(l[c]=0);this.__GET_CALLSTACK_SIZE__[c]+=1;if(1<this.__GET_CALLSTACK_SIZE__[c])return this[g];
a=e(this,d.call(this,g));delete this.__GET_CALLSTACK_SIZE__[c];return a}e(this,a);q.call(this,g,a);return this};!1===l&&(a.prototype[c].__STRINGIFY__=!1);a.prototype[c].is_valid=f;a.__PROPERTIES__||(a.__PROPERTIES__=[]);a.__PROPERTIES__.push(c);a.properties||(a.properties=function(){return b.is_function(a.__super__.properties)?a.__super__.properties().concat(a.__PROPERTIES__):a.__PROPERTIES__});a.__VALIDATORS__||(a.__VALIDATORS__={});a.__VALIDATORS__[c]=f;r&&(a.__INITIALIZERS__[g]=r);return!0};d.def_properties=
function(a,c){var l,e,g;h.assert(b.is_function(a)&&f(a.prototype),"Expected "+a.name+"="+h.to_string(a)+" to inherit from Entity");h.assert(b.is_object(c));g=[];for(e in c)q.call(c,e)&&(l=c[e],g.push(this.def_property(a,e,l)));return g};d.def_abstract_method=function(a,c,l){l=l.arity;h.assert(b.is_undefined(l)||b.is_non_negative_number(l),"Expected arity="+h.to_string(l)+" to be a non-negative number");a.__ABSTRACT_METHODS__||(a.__ABSTRACT_METHODS__={});a.__ABSTRACT_METHODS__[c]={};if(b.is_defined(l))return a.__ABSTRACT_METHODS__[c].arity=
l};d.def_abstract_methods=function(a,c){var l,e,g;h.assert(b.is_function(a));h.assert(b.is_object(c));g=[];for(l in c)q.call(c,l)&&(e=c[l],g.push(this.def_abstract_method(a,l,e)));return g};d.find_property=function(a,c){h.assert(f(a.prototype));h.assert(b.is_string(c));return b.is_function(a.prototype[c])?a.prototype[c]:a.__super__&&f(a.__super__.prototype)?this.find_property(a.__super__,c):null};d.def_toString=function(a,c){var l,g,d,m,r,q;h.assert(b.is_function(a)&&f(a.prototype));h.assert(b.is_undefined(c)||
b.is_string(c));c||(c=a.name);l=[];q=a.properties();m=0;for(r=q.length;m<r;m++)d=q[m],(g=this.find_property(a,d))&&!1!==g.__STRINGIFY__&&l.push(d);a.prototype.toString=function(){var a,b,d,r;b=[];d=0;for(r=l.length;d<r;d++)g=l[d],a=e(this,g),b.push(g+": "+h.to_string(a));return""+c+" {"+b.join(", ")+"}"};return!0};d.prototype.validate=function(){var a,c,b,e;e=this.__TYPE__.__VALIDATORS__;for(c in e)if(q.call(e,c)){a=e[c];b=this[c]();if(!a.call(this,b))throw Error(""+h.to_string(b)+" is invalid for "+
c+" according to "+a+" for "+h.to_string(this));g(b)}return this};d.prototype.equals=function(a,c){var l,e,g,d;b.is_undefined(c)&&(c=a,a=this);if(f(a)){if(f(c)){d=a.constructor.properties();e=0;for(g=d.length;e<g;e++)if(l=d[e],!this.equals(a[l](),c[l]()))return!1;return!0}return!1}return a===c};return d}();f=b.is_instance(k);d.vst||(d.vst={});d.vst.Entity=k}).call(this);
(function(){var k,h,d,f;"undefined"!==typeof exports?(d=exports,f=require("./predicates").vst.predicates,h=require("./functions").vst.functions):"undefined"!==typeof window?(d=window,f=window.vst.predicates,h=window.vst.functions):(d=this,f=this.vst.predicates,h=this.vst.functions);k=function(){function d(b,e,g){this.compare=b;this.heap=null!=e?e:[];this.length=null!=g?g:this.heap.length;h.assert(f.is_array(this.heap));h.assert(f.is_bounded(0,this.heap.length)(this.length));h.assert(f.is_function(this.compare));
this._build()}d.prototype._parent=function(b){return 0<b?(b+1>>1)-1:0};d.prototype._left_child=function(b){return(b<<1)+1};d.prototype._right_child=function(b){return(b<<1)+2};d.prototype._heapify=function(b){var e,g,d;g=this._left_child(b);d=this._right_child(b);e=this.heap;g=g<this.length&&0<this.compare(e[g],e[b])?g:b;d<this.length&&0<this.compare(e[d],e[g])&&(g=d);g!==b&&(d=e[b],e[b]=e[g],e[g]=d,this._heapify(g));return null};d.prototype._build=function(){var b;for(b=this.length>>1;0<=b;)this._heapify(b),
b-=1;return null};d.prototype.increase_key=function(b,e){var d,f,m,a,c;d=this.compare;f=this.heap;if(0>d(e,f[b]))throw Error("Expected "+e+" to be at least heap["+b+"] = "+f[b]);f[b]=e;a=this._parent;for(m=a(b);b&&0>d(f[m],f[b]);)c=f[b],f[b]=f[m],f[m]=c,b=m,m=a(b);return null};d.prototype.sort=function(){var b,e,d;this._build();e=this.length-1;for(b=this.heap;0<=e;)d=b[0],b[0]=b[e],b[e]=d,this.length-=1,this._heapify(0),e-=1;return null};d.prototype.peek=function(){return this.length?this.heap[0]:
null};d.prototype.pop=function(){var b,e;return this.length?(b=this.heap,e=b[0],b[0]=b[this.length-1],this.length-=1,this._heapify(0),e):null};d.prototype.push=function(b){var e,d,f,m,a;f=this.length;this.length+=1;a=this._parent;m=a(f);d=this.heap;for(e=this.compare;0<f&&0>e(d[m],b);)d[f]=d[m],f=m,m=a(f);d[f]=b;return null};d.prototype.clear=function(){this.length=this.heap.length=0;return null};return d}();d.vst||(d.vst={});d.vst.MaxHeap=k}).call(this);
(function(){var k,h,d,f,p,b,e,g,q,m,a,c={}.hasOwnProperty,l=function(a,b){function l(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);l.prototype=b.prototype;a.prototype=new l;a.__super__=b.prototype;return a},t=[].slice;"undefined"!==typeof exports?(q=exports,k=require("./entity").vst.Entity,a=require("./predicates").vst.predicates,g=require("./functions").vst.functions):"undefined"!==typeof window?(q=window,k=window.vst.Entity,a=window.vst.predicates,g=windwow.vst.functions):(q=this,
k=this.vst.Entity,a=this.vst.predicates,g=this.vst.functions);d=function(c){function d(){return d.__super__.constructor.apply(this,arguments)}l(d,c);d.prototype.Iterator=function(a){null==a&&(a=[]);if(this.constructor===d)throw Error("vst.Iterator should not be instantiated directly");if(0===a.length)throw Error("You must specify the subtype as an array to this constructor");a.push(d);return d.__super__.Iterator.call(this,a)};d.prototype.has_next=function(){this.advance();return null!==this.next_element()};
d.prototype.peek=function(){this.advance();return this.next_element()};d.prototype.next=function(){var a;this.advance();a=this.next_element();this.next_element(null);return a};d.prototype.to_array=function(){var a;for(a=[];this.has_next();)a.push(this.next());return a};d.prototype.mapref=function(){var a,c;c=arguments[0];a=2<=arguments.length?t.call(arguments,1):[];return this.map(function(){return this[c].apply(this,a)})};d.prototype.map=function(a){return f.of(this,a)};d.prototype.each=function(c){var b,
l;g.assert(a.is_function(c));for(l=0;this.has_next();){b=this.next();if(!1===c.call(b,b,l))return!1;l+=1}return!0};d.prototype.select=function(a){return p.of(this,a)};d.prototype.exclude=function(a){return h.of(this,a)};d.prototype.take=function(a){return b.of(this,a)};d.prototype.take_while=function(a){return e.of(this,a)};d.prototype.drop=function(c){var b;g.assert(a.is_non_negative_number(c));for(b=-1;(b+=1)<c&&this.has_next();)this.next();return this};d.prototype.drop_while=function(c){var b;
g.assert(a.is_function(c));for(b=-1;(b+=1)<n&&this.has_next()&&c.call(this.peek(),this.peek());)this.next();return this};return d}(k);k.def_abstract_methods(d,{advance:{arity:0}});k.def_properties(d,{next_element:{initial_value:null,is_valid:a.tautology}});m=a.is_instance(d);f=function(c){function b(c){null==c&&(c=[]);g.assert(a.is_array(c));c.push(b);b.__super__.constructor.call(this,c)}l(b,c);b.of=function(a,c){return(new b).iterator(a).fn(c)};b.prototype.advance=function(){var a;null===this.next_element()&&
this.iterator().has_next()&&(a=this.iterator().next(),this.next_element(this.fn().call(a,a,this.i())),this.i(1+this.i()));return!0};return b}(d);k.def_properties(f,{iterator:{is_valid:m},fn:{is_valid:a.is_function},i:{is_valid:a.is_non_negative_number,initial_value:0}});k.def_toString(f);b=function(c){function b(c){null==c&&(c=[]);g.assert(a.is_array(c));c.push(b);b.__super__.constructor.call(this,c)}l(b,c);b.of=function(a,c){return(new b).iterator(a).n(c)};b.prototype.advance=function(){null===this.next_element()&&
this.i()<this.n()&&this.next_element(this.iterator().next());return!0};return b}(d);k.def_properties(b,{iterator:{is_valid:m},n:{is_valid:a.is_non_negative_number},i:{is_valid:a.is_non_negative_number,initial_value:0}});k.def_toString(b);e=function(c){function b(c){null==c&&(c=[]);g.assert(a.is_array(c));c.push(b);b.__super__.constructor.call(this,c)}l(b,c);b.of=function(a,c){return(new b).iterator(a).n(c)};b.prototype.advance=function(){var a;null===this.next_element()&&this.iterator().has_next()&&
(a=this.iterator().peek(),this.is_valid().call(a,a)&&this.next_element(this.iterator().next()));return!0};return b}(d);k.def_properties(e,{iterator:{is_valid:m},is_valid:{is_valid:a.is_function}});k.def_toString(e);p=function(c){function b(c){null==c&&(c=[]);g.assert(a.is_array(c));c.push(b);b.__super__.constructor.call(this,c)}l(b,c);b.of=function(a,c){return(new b).iterator(a).is_valid(c)};b.prototype.advance=function(){var a;if(null===this.next_element()){for(a=this.iterator().next();a&&!1===this.is_valid().call(a,
a);)a=this.iterator().next();this.next_element(a)}return!0};return b}(d);k.def_properties(p,{iterator:{is_valid:m},is_valid:{is_valid:a.is_function}});k.def_toString(p);h=function(c){function b(c){null==c&&(c=[]);g.assert(a.is_array(c));c.push(b);b.__super__.constructor.call(this,c)}l(b,c);b.of=function(a,c){return(new b).iterator(a).is_valid(c)};b.prototype.advance=function(){var a;if(null===this.next_element()){for(a=this.iterator().next();a&&!0===this.is_valid().call(a,a);)a=this.iterator().next();
this.next_element(a)}return!0};return b}(d);k.def_properties(h,{iterator:{is_valid:m},is_valid:{is_valid:a.is_function}});k.def_toString(h);q.vst||(q.vst={});q.vst.Iterator=d}).call(this);
(function(){var k,h,d,f,p={}.hasOwnProperty,b=function(b,d){function f(){this.constructor=b}for(var m in d)p.call(d,m)&&(b[m]=d[m]);f.prototype=d.prototype;b.prototype=new f;b.__super__=d.prototype;return b};"undefined"!==typeof exports?(d=exports,k=require("./entity").vst.Entity,f=require("./predicates").vst.predicates,require("./functions")):"undefined"!==typeof window?(d=window,k=window.vst.Entity,f=window.vst.predicates):(d=this,k=this.vst.Entity,f=this.vst.predicates);h=function(d){function g(b){null==
b&&(b=[]);if(this.constructor===g)throw Error("vst.Node should not be instantiated directly");if(0===b.length)throw Error("You must specify the subtype as an array to this constructor");b.push(g);g.__super__.constructor.call(this,b)}b(g,d);g.prototype.is_leaf=function(){return null===this.lesser_child()&&null===this.greater_child()};g.prototype.is_branch=function(){return!!this.lesser_child()^1===!!this.greater_child()};g.prototype.value=function(){if(0===this.values().length)return null;if(1===this.values().length)return this.values()[0];
throw Error("There are multiple values, please use Node::values() instead.");};return g}(k);k.def_properties(h,{key:{is_valid:f.tautology},values:{is_valid:f.is_array,init:function(){return[]}},height:{initial_value:0,is_valid:f.is_non_negative_number},greater_child:{initial_value:null,is_valid:f.disjoin(f.is_null,f.is_instance(h))},lesser_child:{initial_value:null,is_valid:f.disjoin(f.is_null,f.is_instance(h))},greater_neighbor:{initial_value:null,is_valid:f.disjoin(f.is_null,f.is_instance(h)),stringify:!1},
lesser_neighbor:{initial_value:null,is_valid:f.disjoin(f.is_null,f.is_instance(h)),stringify:!1}});f.is_instance(h);d.vst||(d.vst={});d.vst.Node=h}).call(this);
(function(){var k,h,d,f,p,b={}.hasOwnProperty,e=function(d,e){function f(){this.constructor=d}for(var a in e)b.call(e,a)&&(d[a]=e[a]);f.prototype=e.prototype;d.prototype=new f;d.__super__=e.prototype;return d};"undefined"!==typeof exports?(f=exports,k=require("./entity").vst.Entity,h=require("./iterator").vst.Iterator,d=require("./node").vst.Node,p=require("./predicates").vst.predicates):"undefined"!==typeof window?(f=window,k=window.vst.Entity,h=window.vst.Iterator,d=window.vst.Node,p=window.vst.predicates):
(f=this,k=this.vst.Entity,h=this.vst.Iterator,d=this.vst.Node,p=this.vst.predicates);h=function(b){function d(b){null==b&&(b=[]);if(!(this instanceof d))return new d(b);b.push(d);d.__super__.constructor.call(this,b)}e(d,b);d.of=function(b,a,c){return(new d).node(b).upper_key(a).comparator(c)};d.empty=function(){return this.of(null,-1,function(b,a){return 1})};d.prototype.advance=function(){null===this.next_element()&&this.node()&&0>=this.comparator()(this.node().key(),this.upper_key())&&(this.next_element(this.node()),
this.node(this.node().greater_neighbor()));return!0};return d}(h);k.def_properties(h,{comparator:{is_valid:p.conjoin(p.is_function,p.has_arity(2))},node:{is_valid:p.disjoin(p.is_null,p.is_instance(d))},upper_key:{is_valid:p.tautology}});k.def_toString(h);f.vst||(f.vst={});f.vst.RangeIterator=h}).call(this);
(function(){var k,h,d,f,p,b,e,g={}.hasOwnProperty,q=function(b,a){function c(){this.constructor=b}for(var d in a)g.call(a,d)&&(b[d]=a[d]);c.prototype=a.prototype;b.prototype=new c;b.__super__=a.prototype;return b};"undefined"!==typeof exports?(b=exports,k=require("./entity").vst.Entity,h=require("./iterator").vst.Iterator,d=require("./node").vst.Node,e=require("./predicates").vst.predicates,f=require("./functions").vst.functions):"undefined"!==typeof window?(b=window,k=window.vst.Entity,h=window.vst.Iterator,
d=window.vst.Node,e=window.vst.predicates,f=windwow.vst.functions):(b=this,k=this.vst.Entity,h=this.vst.Iterator,d=this.vst.Node,e=this.vst.predicates,f=this.vst.functions);p=function(b,a,c,d,e){for(var g,f,h;;)if(c)if(d)if(g=e(a.key(),b),f=e(c.key(),b),h=e(d.key(),b),f<g)h<f?(a=d,d=d.greater_neighbor()):(a=c,c=c.lesser_neighbor());else if(h<g)a=d,d=d.greater_neighbor();else return a;else if(e(c.key(),b)<e(a.key(),b))a=c,c=c.lesser_neighbor();else return a;else if(d)if(e(d.key(),b)<e(a.key(),b))a=
d,d=d.greater_neighbor();else return a;else return a};h=function(b){function a(c){null==c&&(c=[]);f.assert(e.is_array(c));c.push(a);a.__super__.constructor.call(this,c)}q(a,b);a.of=function(c,b,g,h){var k,m;f.assert(c instanceof d);f.assert(e.is_defined(b));f.assert(e.is_non_negative_number(g));f.assert(e.is_function(h));m=c.lesser_neighbor();k=c.greater_neighbor();for(c=p(b,c,m,k,h);m=c.lesser_neighbor();)if(h(m.key(),b)<h(c.key(),b))c=m;else break;for(;k=c.greater_neighbor();)if(h(k.key(),b)<h(c.key(),
b))c=k;else break;b=(new a).distance(h).key(b).k(g);0<g&&b.next_element(c).greater_neighbor(c.greater_neighbor()).lesser_neighbor(c.lesser_neighbor()).i(1);return b};a.empty=function(){return(new a).neighbors([])};a.prototype.advance=function(){var a,b;null===this.next_element()&&this.i()<this.k()&&(this.lesser_neighbor()?(this.greater_neighbor()?(b=this.distance()(this.lesser_neighbor().key(),this.key()),a=this.distance()(this.greater_neighbor().key(),this.key()),b<a?(this.next_element(this.lesser_neighbor()),
this.lesser_neighbor(this.lesser_neighbor().lesser_neighbor())):(this.next_element(this.greater_neighbor()),this.greater_neighbor(this.greater_neighbor().greater_neighbor()))):(this.next_element(this.lesser_neighbor()),this.lesser_neighbor(this.lesser_neighbor().lesser_neighbor())),this.i(1+this.i())):this.greater_neighbor()&&(this.next_element(this.greater_neighbor()),this.greater_neighbor(this.greater_neighbor().greater_neighbor()),this.i(1+this.i())));return!0};return a}(h);k.def_properties(h,
{node:{is_valid:e.is_instance(d)},lesser_neighbor:{is_valid:e.disjoin(e.is_instance(d),e.is_null)},greater_neighbor:{is_valid:e.disjoin(e.is_instance(d),e.is_null)},key:{is_valid:e.is_defined},k:{is_valid:e.is_non_negative_number},i:{is_valid:e.is_non_negative_number,initial_value:0},distance:{is_valid:e.is_function}});k.def_toString(h);b.vst||(b.vst={});b.vst.NearestNeighborIterator=h}).call(this);
(function(){var k,h,d,f,p,b,e,g,q={}.hasOwnProperty,m=function(a,b){function d(){this.constructor=a}for(var e in b)q.call(b,e)&&(a[e]=b[e]);d.prototype=b.prototype;a.prototype=new d;a.__super__=b.prototype;return a};"undefined"!==typeof exports?(e=exports,k=require("./entity").vst.Entity,d=require("./node").vst.Node,f=require("./range_iterator").vst.RangeIterator,h=require("./nearest_neighbor_iterator").vst.NearestNeighborIterator,require("./max_heap"),g=require("./predicates").vst.predicates,b=require("./functions").vst.functions):
"undefined"!==typeof window?(e=window,k=window.vst.Entity,d=window.vst.Node,f=window.vst.RangeIterator,h=window.vst.NearestNeighborIterator,g=window.vst.predicates,b=window.vst.functions):(e=this,k=this.vst.Entity,d=this.vst.Node,f=this.vst.RangeIterator,h=this.vst.NearestNeighborIterator,g=this.vst.predicates,b=this.vst.functions);p=function(a){function c(a){null==a&&(a=[]);if(this.constructor===c)throw Error("vst.Tree should not be instantiated directly");if(0===a.length)throw Error("You must specify the subtype as an array to this constructor");
a.push(c);c.__super__.constructor.call(this,a)}m(c,a);c.prototype.is_node_type=function(a){return a instanceof this.NodeType()};c.prototype.assert_is_node_type=function(a){return b.assert(this.is_node_type(a),"Expected "+b.to_string(a)+" to be a "+this.NodeType().name)};c.prototype.height=function(){return g.is_defined(this.root())?this.root().height():0};c.prototype.greatest=function(a){null==a&&(a=this.root());if(null===a)return null;for(this.assert_is_node_type(a);a.greater_child();)a=a.greater_child();
return a};c.prototype.least=function(a){null==a&&(a=this.root());if(null===a)return null;for(this.assert_is_node_type(a);a.lesser_child();)a=a.lesser_child();return a};c.prototype.try_insert=function(a,c){b.assert(g.is_defined(a));return g.is_null(this.root())?(this.root(this.NodeType().of(a,c)),this.size(this.size()+1),!0):!1===this.contains_key(a)?(this.add_descendant(this.root(),this.NodeType().of(a,c)),this.size(this.size()+1),!0):!1};c.prototype.insert=function(a,c){var d;b.assert(g.is_defined(a));
null===this.root()?this.root(this.NodeType().of(a,c)):(d=this.find(a))?d.values().push(c):this.add_descendant(this.root(),this.NodeType().of(a,c));this.size(this.size()+1);return this};c.prototype.contains_key=function(a){b.assert(g.is_defined(a));return null!==this.find(a)};c.prototype.find=function(a){var c,d;b.assert(g.is_defined(a));for(d=this.root();d;)if(c=this.comparator()(a,d.key()),0<c)d=d.greater_child();else if(0>c)d=d.lesser_child();else break;return d};c.prototype.find_nearest=function(a){var c,
d;b.assert(g.is_defined(a));for(d=this.root();d;)if(c=this.comparator()(a,d.key()),0<c){if(null===d.greater_child())break;d=d.greater_child()}else if(0>c){if(null===d.lesser_child())break;d=d.lesser_child()}else break;return d};c.prototype.find_nearest_gte=function(a){var c;b.assert(g.is_defined(a));for(c=this.find_nearest(a);c&&0>this.comparator()(c.key(),a);)c=c.greater_neighbor();return c};c.prototype.find_nearest_lte=function(a){var c;b.assert(g.is_defined(a));for(c=this.find_nearest(a);c&&0<
this.comparator()(c.key(),a);)c=c.lesser_neighbor();return c};c.prototype.remove=function(a,c){var d,e,f,h,k,m;b.assert(g.is_defined(a));if(f=this.find(a)){if(g.is_defined(c)){m=f.values();e=h=0;for(k=m.length;h<k;e=++h)if(d=m[e],d===c)return f.values().splice(e,1),0===f.values().length&&this.remove_node(f),this.size(this.size()-1),!0;return!1}this.size(this.size()-f.values().length);this.remove_node(f);return!0}return!1};c.prototype.preorder=function(a,c){null==c&&(c=this.root());c&&(a(c),c.lesser_child()&&
this.preorder(a,c.lesser_child()),c.greater_child()&&this.preorder(a,c.greater_child()));return this};c.prototype.inorder=function(a,c){null==c&&(c=this.root());c&&(c.lesser_child()&&this.inorder(a,c.lesser_child()),a(c),c.greater_child()&&this.inorder(a,c.greater_child()));return this};c.prototype.postorder=function(a,c){null==c&&(c=this.root());c&&(c.lesser_child()&&this.postorder(a,c.lesser_child()),c.greater_child()&&this.postorder(a,c.greater_child()),a(c));return this};c.prototype.range=function(a,
c){var d;b.assert(0>=this.comparator()(a,c),"Expected lower:"+b.to_string(a)+" <= upper:"+b.to_string(c));d=this.find_nearest_gte(a);return f.of(d,c,this.comparator())};c.prototype.neighbors=function(a,c,d){var e,h,k;b.assert(g.is_defined(a));b.assert(g.is_non_negative_number(c));b.assert(g.is_non_negative_number(d));if(k=this.find_nearest(a)){e=this.comparator()(k.key(),a);if(a=0>e?k:k.lesser_neighbor())for(h=1;h<c&&a.lesser_neighbor();)a=a.lesser_neighbor(),h+=1;if(c=0<e?k:k.greater_neighbor())for(h=
1;h<d&&c.greater_neighbor();)c=c.greater_neighbor(),h+=1;d=a||k;k=(null!=c?c.key():void 0)||k.key();return f.of(d,k,this.comparator())}return f.empty()};c.prototype.nearest_neighbors=function(a,c,d){var e;b.assert(g.is_defined(a));b.assert(g.is_non_negative_number(c));b.assert(g.is_function(d)&&2===d.length);return(e=this.find_nearest(a))?h.of(e,a,c,d):h.empty()};return c}(k);k.def_abstract_methods(p,{add_descendant:{arity:2},remove_node:{arity:1}});k.def_properties(p,{comparator:{is_valid:g.disjoin(g.conjoin(g.is_function,
g.has_arity(2)),g.is_undefined)},size:{initial_value:0,is_valid:g.is_non_negative_number},NodeType:{is_valid:g.disjoin(g.is_type(d),g.is_undefined)},root:{initial_value:null,is_valid:g.disjoin(g.is_null,g.conjoin(g.is_instance(d),p.prototype.is_node_type))}});e.vst||(e.vst={});e.vst.Tree=p}).call(this);
(function(){var k,h,d,f,p,b={}.hasOwnProperty,e=function(d,e){function f(){this.constructor=d}for(var a in e)b.call(e,a)&&(d[a]=e[a]);f.prototype=e.prototype;d.prototype=new f;d.__super__=e.prototype;return d};"undefined"!==typeof exports?(d=exports,h=require("./entity").vst.Entity,k=require("./node").vst.Node,p=require("./predicates").vst.predicates,require("./functions")):"undefined"!==typeof window?(d=window,h=window.vst.Entity,k=window.vst.Node,p=window.vst.predicates):(d=this,h=this.vst.Entity,
k=window.vst.Node,p=this.vst.predicates);k=function(b){function d(b){null==b&&(b=[]);if(!(this instanceof d))return new d(b);b.push(d);d.__super__.constructor.call(this,b)}e(d,b);d.of=function(b,a){var c;c=(new d).key(b);c.values().push(a);return c};d.prototype.max_child_height=function(){var b,a;a=this.lesser_child()?this.lesser_child().height():-1;b=this.greater_child()?this.greater_child().height():-1;return Math.max(a,b)};d.prototype.balance=function(){var b,a;a=this.lesser_child()?this.lesser_child().height():
-1;b=this.greater_child()?this.greater_child().height():-1;return a-b};d.prototype.is_balanced=function(){var b;return-1<=(b=this.balance())&&1>=b};return d}(k);f=p.is_instance(k);h.def_properties(k,{parent:{initial_value:null,is_valid:p.disjoin(f,p.is_null),stringify:!1}});h.def_toString(k);d.vst||(d.vst={});d.vst.AvlNode=k}).call(this);
(function(){var k,h,d,f,p,b,e={}.hasOwnProperty,g=function(b,d){function a(){this.constructor=b}for(var c in d)e.call(d,c)&&(b[c]=d[c]);a.prototype=d.prototype;b.prototype=new a;b.__super__=d.prototype;return b};"undefined"!==typeof exports?(p=exports,d=require("./entity").vst.Entity,k=require("./avl_node").vst.AvlNode,h=require("./tree").vst.Tree,b=require("./predicates").vst.predicates,f=require("./functions").vst.functions):"undefined"!==typeof window?(p=window,d=window.vst.Entity,k=window.vst.AvlNode,
h=window.vst.Tree,b=window.vst.predicates,f=window.vst.functions):(p=this,d=this.vst.Entity,k=this.vst.AvlNode,h=this.vst.Tree,b=this.vst.predicates,f=this.vst.functions);h=function(d){function e(a){null==a&&(a=[]);if(!(this instanceof e))return new e(a);a.push(e);e.__super__.constructor.call(this,a)}g(e,d);e.of=function(a){return(new e).NodeType(k).comparator(a)};e.prototype.greater_greater_case=function(a){var c;this.assert_is_node_type(a);f=a.parent();c=a.greater_child();c.greater_child();a.greater_child(c.lesser_child());
a.greater_child()&&a.greater_child().parent(a);c.lesser_child(a);a.parent(c);f?(f.greater_child()===a?f.greater_child(c):f.lesser_child(c),c.parent(f)):(c.parent(null),this.root(c));this.recompute_heights(a);this.recompute_heights(c.parent());return this};e.prototype.greater_lesser_case=function(a){var c,b;this.assert_is_node_type(a);f=a.parent();c=a.greater_child();b=c.lesser_child();c.lesser_child(b.greater_child());c.lesser_child()&&c.lesser_child().parent(c);a.greater_child(b.lesser_child());
a.greater_child()&&a.greater_child().parent(a);b.greater_child(c);c.parent(b);b.lesser_child(a);a.parent(b);f?(f.greater_child()===a?f.greater_child(b):f.lesser_child(b),b.parent(f)):(b.parent(null),this.root(b));this.recompute_heights(a);this.recompute_heights(c);return this};e.prototype.lesser_lesser_case=function(a){var c;this.assert_is_node_type(a);f=a.parent();c=a.lesser_child();c.lesser_child();a.lesser_child(c.greater_child());a.lesser_child()&&a.lesser_child().parent(a);c.greater_child(a);
a.parent(c);f?(f.greater_child()===a?f.greater_child(c):f.lesser_child(c),c.parent(f)):(c.parent(null),this.root(c));this.recompute_heights(a);this.recompute_heights(c.parent());return this};e.prototype.lesser_greater_case=function(a){var c,b;this.assert_is_node_type(a);f=a.parent();c=a.lesser_child();b=c.greater_child();a.lesser_child(b.greater_child());a.lesser_child()&&a.lesser_child().parent(a);c.greater_child(b.lesser_child());c.greater_child()&&c.greater_child().parent(c);b.lesser_child(c);
c.parent(b);b.greater_child(a);a.parent(b);f?(f.greater_child()===a?f.greater_child(b):f.lesser_child(b),b.parent(f)):(b.parent(null),this.root(b));this.recompute_heights(a);this.recompute_heights(c);return this};e.prototype.rebalance=function(a){var c;this.assert_is_node_type(a);c=a.balance();-2>=c?0>=a.greater_child().balance()?this.greater_greater_case(a):this.greater_lesser_case(a):2<=c&&(0<=a.lesser_child().balance()?this.lesser_lesser_case(a):this.lesser_greater_case(a));return this};e.prototype.recompute_heights=
function(a){var c;if(b.is_defined(a))for(this.assert_is_node_type(a),c=!0;a&&c;)c=a.height(),a.height(a.greater_child()||a.lesser_child()?1+a.max_child_height():0),c=a.height!==c,a=a.parent();return this};e.prototype.add_descendant=function(a,c){var b,d;this.assert_is_node_type(a);this.assert_is_node_type(c);d=this.comparator()(c.key(),a.key());b=null;0>d?b=this.add_lesser_child(a,c):0<d?b=this.add_greater_child(a,c):this.add_equivalent_child(c);b&&this.rebalance(b);return this};e.prototype.add_lesser_child=
function(a,b){var d,e;this.assert_is_node_type(a);this.assert_is_node_type(b);b.greater_neighbor(a);d=null;if(a.lesser_child())this.add_descendant(a.lesser_child(),b);else if(a.lesser_child(b),b.parent(a),a.lesser_neighbor()&&a.lesser_neighbor().greater_neighbor(b),a.lesser_neighbor(b),0===a.height())for(e=a;e;){e.height(1+e.max_child_height());if(!e.is_balanced()){d=e;break}e=e.parent()}return d};e.prototype.add_greater_child=function(a,b){var d,e;this.assert_is_node_type(a);this.assert_is_node_type(b);
b.lesser_neighbor(a);d=null;if(a.greater_child())this.add_descendant(a.greater_child(),b);else if(a.greater_child(b),b.parent(a),a.greater_neighbor()&&a.greater_neighbor().lesser_neighbor(b),a.greater_neighbor(b),0===a.height())for(e=a;e;){e.height(1+e.max_child_height());if(!e.is_balanced()){d=e;break}e=e.parent()}return d};e.prototype.add_equivalent_child=function(a,b){this.assert_is_node_type(a);this.assert_is_node_type(b);a.values(a.values().concat(b.values()));b.lesser_neighbor(null);b.greater_neighbor(null);
b.lesser_child(null);b.greater_child(null);b.values().length=0;b.parent(null);return null};e.prototype.remove_node=function(a){this.assert_is_node_type(a);a.values().length=0;a.lesser_neighbor()&&a.lesser_neighbor(a.greater_neighbor());a.greater_neighbor()&&a.greater_neighbor(a.lesser_neighbor());a.is_leaf()?this.remove_leaf(a):a.is_branch()?this.remove_branch(a):this.swap_and_remove(a);return this};e.prototype.remove_leaf=function(a){var b;this.assert_is_node_type(a);if(b=a.parent())for(b.lesser_child()===
a?b.lesser_child(null):b.greater_child(null),this.recompute_heights(b);a=a.parent();)a.is_balanced()||this.rebalance(a);else this.root(null);return null};e.prototype.remove_branch=function(a){var b;this.assert_is_node_type(a);if(b=a.parent())for(b.lesser_child()?b.lesser_child(a.greater_child()||a.lesser_child()):b.greater_child(a.greater_child()||a.lesser_child()),a.greater_child()?a.greater_child().parent(b):a.lesser_child().parent(b),this.recompute_heights(b);a=a.parent();)a.is_balanced()||this.rebalance(a);
return null};e.prototype.swap_and_remove=function(a){var b;this.assert_is_node_type(a);b=this.least(a.greater_child());this.swap_nodes(a,b);0===a.height()?this.remove_leaf(a):this.remove_branch(a);return null};e.prototype.swap_nodes=function(a,b){var d,e,f,g,h,k,m;this.assert_is_node_type(a);this.assert_is_node_type(b);k=a.parent();g=a.lesser_child();d=a.greater_child();m=b.parent();h=b.lesser_child();e=b.greater_child();f=a.height();a.height(b.height());b.height(f);k?(k.lesser_child()===a?parent.lesser_child(b):
parent.greater_child(b),b.parent(parent)):(b.parent(null),this.root(b));b.lesser_child(g);g.parent(b);a.lesser_child(h);h.parent(a);e?e.parent(a):m!==a?(b.greater_child(d),d.parent(b),m.lesser_child(a),a.parent(m)):(b.greater_child(a),a.parent(b));return null};return e}(h);d.def_toString(h);p.vst||(p.vst={});p.vst.AvlTree=h}).call(this);
