/*

The MIT License (MIT)

Copyright (c) 2014 Dylon Edwards

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
*/
(function(){var e;e="undefined"!==typeof exports?exports:"undefined"!==typeof window?window:this;e.vst||(e.vst={});e.vst.comparators={c_number:function(f,e){return f-e},c_string_case_sensitive:function(f,e){return f.localeCompare(e)},c_string_case_insensitive:function(f,e){return f.toLowerCase().localeCompare(e.toLowerCase())}}}).call(this);
(function(){var e;e="undefined"!==typeof exports?exports:"undefined"!==typeof window?window:this;e.vst||(e.vst={});e.vst.metrics={m_number:function(f,e){return Math.abs(f-e)}}}).call(this);
(function(){var e,f,l,h=[].slice;e="undefined"!==typeof window?window:"undefined"!==typeof exports?exports:this;f=l={tautology:function(){return!0},contradiction:function(){return!1},is_number:function(b){return"number"===typeof b},is_negative_number:function(b){return f.is_number(b)&&0>b},is_non_positive_number:function(b){return f.is_number(b)&&0>=b},is_non_negative_number:function(b){return f.is_number(b)&&0<=b},is_positive_number:function(b){return f.is_number(b)&&0<b},is_boolean:function(b){return"boolean"===
typeof b},is_string:function(b){return"string"===typeof b},is_function:function(b){return"function"===typeof b},is_constructor:function(b){return f.is_function(b)&&f.is_object(b.prototype)},is_null:function(b){return null===b},is_undefined:function(b){return void 0===b},is_defined:function(b){return!f.is_undefined(b)&&!f.is_null(b)},is_object:function(b){return"object"===typeof b&&!f.is_null(b)},is_array:function(b){return f.is_object(b)&&f.is_non_negative_number(b.length)},has_arity:function(b){return function(d){return d.length===
b}},is_instance:function(b){return function(d){return d instanceof b}},is_type:function(b){return function(d){return f.is_function(d)&&d.prototype instanceof b}},is_bounded:function(b,d){return function(m){return f.is_number(m)&&b<=m&&m<=d}},is_lt:function(b){return function(d){return f.is_number(d)&&d<b}},is_lte:function(b){return function(d){return f.is_number(d)&&d<=b}},is_eq:function(b){return function(d){return f.is_number(d)&&d===b}},is_gte:function(b){return function(d){return f.is_number(d)&&
d>=b}},is_gt:function(b){return function(d){return f.is_number(d)&&d>b}},is_equal:function(b){return function(d){return d===b}},there_exists:function(b){return function(d){var m,a,g;a=0;for(g=d.length;a<g;a++)if(m=d[a],!0===b.call(this,m))return!0;return!1}},for_all:function(b){return function(d){var m,a,g;a=0;for(g=d.length;a<g;a++)if(m=d[a],!1===b.call(this,m))return!1;return!0}},disjoin:function(){var b,d,m;d=1<=arguments.length?h.call(arguments,0):[];switch(d.length){case 0:return f.tautology;
case 1:return b=d[0],function(a){return b.call(this,a)};case 2:return b=d[0],m=d[1],function(a){return b.call(this,a)||m.call(this,a)};default:return b=d[0],d=2<=d.length?h.call(d,1):[],m=f.disjoin.apply(null,d),function(a){return b.call(this,a)||m.call(this,a)}}},conjoin:function(){var b,d,m;d=1<=arguments.length?h.call(arguments,0):[];switch(d.length){case 0:return f.tautology;case 1:return b=d[0],function(a){return b.call(this,a)};case 2:return b=d[0],m=d[1],function(a){return b.call(this,a)&&
m.call(this,a)};default:return b=d[0],d=2<=d.length?h.call(d,1):[],m=f.conjoin.apply(null,d),function(a){return b.call(this,a)&&m.call(this,a)}}}};e.vst||(e.vst={});e.vst.predicates=l}).call(this);
(function(){var e,f,l,h,b=[].slice,d={}.hasOwnProperty;"undefined"!==typeof exports?(l=exports,h=require("./predicates").vst.predicates):"undefined"!==typeof window?(l=window,h=window.vst.predicates):(l=this,h=this.vst.predicates);e=f={assert:function(d,a){if(!h.is_boolean(d))throw Error("Expected truth="+e.to_string(d)+" to be a boolean");if(!h.is_undefined(a)&&!h.is_string(a))throw Error("Expected message="+e.to_string(a)+" to be a string");if(!1===d){if(h.is_undefined(a))throw Error("Assertion failed");
throw Error("Assertion failed: "+a);}},proxy:function(d,a){return function(){var g;g=1<=arguments.length?b.call(arguments,0):[];return d.apply(a,g)}},to_string:function(b){var a,g,p,c;if(h.is_null(b))return"null";if(h.is_undefined(b))return"undefined";if(h.is_array(b)){g=[];p=0;for(c=b.length;p<c;p++)a=b[p],g.push(e.to_string(a));return"["+g.join(", ")+"]"}if(h.is_object(b)){if(b.toString===Object.prototype.toString){a=[];for(g in b)d.call(b,g)&&(p=b[g],a.push(g+": "+e.to_string(p)));return"{"+a.join(", ")+
"}"}return b.toString()}return h.is_string(b)?'"'+b+'"':b.toString()}};l.vst||(l.vst={});l.vst.functions=f}).call(this);
(function(){var e,f,l,h,b,d,m={}.hasOwnProperty;"undefined"!==typeof exports?(l=exports,b=require("./predicates").vst.predicates,f=require("./functions").vst.functions):"undefined"!==typeof window?(l=window,b=window.vst.predicates,f=window.vst.functions):(l=this,b=this.vst.predicates,f=this.vst.functions);d=function(a,g){return b.is_function(a[g])?a[g]():a[g]};e=function(){function a(g){var a,c,k,d,b,r,f;b=0;for(r=g.length;b<r;b++)if(d=g[b],void 0!==d){if(d.__ABSTRACT_METHODS__)for(a in f=d.__ABSTRACT_METHODS__,
f)m.call(f,a)&&(c=f[a],a[a]={type:d,attrs:c});d=d.__INITIALIZERS__;for(k in d)m.call(d,k)&&(c=d[k],this[k]=c.call(this,k))}this.__TYPE__=g[g.length-1]}a.def_property=function(g,a,c){var k,d,q,r,m;r=c.initial_value;d=c.get;q=c.init;m=c.set;c=c.stringify;d||(d=function(c){return this[c]});m||(m=function(c,k){return this[c]=k});1===m.length&&(m=function(c){return function(k,a){return c(a)}}(m));k="__"+a;b.is_undefined(r)||(g.prototype[k]=r);g.__INITIALIZERS__||(g.__INITIALIZERS__={});g.prototype[a]=
function(c){if(b.is_undefined(c))return this[k];m.call(this,k,c);return this};!1===c&&(g.prototype[a].__STRINGIFY__=!1);g.__PROPERTIES__||(g.__PROPERTIES__=[]);g.__PROPERTIES__.push(a);g.properties||(g.properties=function(){return b.is_function(g.__super__.properties)?g.__super__.properties().concat(g.__PROPERTIES__):g.__PROPERTIES__});q&&(g.__INITIALIZERS__[k]=q);return!0};a.def_properties=function(a,d){var c,k,b;b=[];for(k in d)m.call(d,k)&&(c=d[k],b.push(this.def_property(a,k,c)));return b};a.def_abstract_method=
function(a,d,c){c=c.arity;a.__ABSTRACT_METHODS__||(a.__ABSTRACT_METHODS__={});a.__ABSTRACT_METHODS__[d]={};if(b.is_defined(c))return a.__ABSTRACT_METHODS__[d].arity=c};a.def_abstract_methods=function(a,d){var c,k,b;b=[];for(c in d)m.call(d,c)&&(k=d[c],b.push(this.def_abstract_method(a,c,k)));return b};a.find_property=function(a,d){return b.is_function(a.prototype[d])?a.prototype[d]:a.__super__&&h(a.__super__.prototype)?this.find_property(a.__super__,d):null};a.def_toString=function(a,b){var c,k,m,
q,r,e;b||(b=a.name);c=[];e=a.properties();q=0;for(r=e.length;q<r;q++)m=e[q],(k=this.find_property(a,m))&&!1!==k.__STRINGIFY__&&c.push(m);a.prototype.toString=function(){var a,g,q,m;g=[];q=0;for(m=c.length;q<m;q++)k=c[q],a=d(this,k),g.push(k+": "+f.to_string(a));return""+b+" {"+g.join(", ")+"}"};return!0};a.prototype.equals=function(a,d){var c,k,m,q;b.is_undefined(d)&&(d=a,a=this);if(h(a)){if(h(d)){q=a.constructor.properties();k=0;for(m=q.length;k<m;k++)if(c=q[k],!this.equals(a[c](),d[c]()))return!1;
return!0}return!1}return a===d};return a}();h=b.is_instance(e);l.vst||(l.vst={});l.vst.Entity=e}).call(this);
(function(){var e,f,l,h;"undefined"!==typeof exports?(l=exports,h=require("./predicates").vst.predicates,f=require("./functions").vst.functions):"undefined"!==typeof window?(l=window,h=window.vst.predicates,f=window.vst.functions):(l=this,h=this.vst.predicates,f=this.vst.functions);e=function(){function b(d,b,a){this.compare=d;this.heap=null!=b?b:[];this.length=null!=a?a:this.heap.length;f.assert(h.is_array(this.heap));f.assert(h.is_bounded(0,this.heap.length)(this.length));f.assert(h.is_function(this.compare));
this._build()}b.prototype._parent=function(d){return 0<d?(d+1>>1)-1:0};b.prototype._left_child=function(d){return(d<<1)+1};b.prototype._right_child=function(d){return(d<<1)+2};b.prototype._heapify=function(d){var b,a,g;a=this._left_child(d);g=this._right_child(d);b=this.heap;a=a<this.length&&0<this.compare(b[a],b[d])?a:d;g<this.length&&0<this.compare(b[g],b[a])&&(a=g);a!==d&&(g=b[d],b[d]=b[a],b[a]=g,this._heapify(a));return null};b.prototype._build=function(){var d;for(d=this.length>>1;0<=d;)this._heapify(d),
d-=1;return null};b.prototype.increase_key=function(d,b){var a,g,p,c,k;a=this.compare;g=this.heap;if(0>a(b,g[d]))throw Error("Expected "+b+" to be at least heap["+d+"] = "+g[d]);g[d]=b;c=this._parent;for(p=c(d);d&&0>a(g[p],g[d]);)k=g[d],g[d]=g[p],g[p]=k,d=p,p=c(d);return null};b.prototype.sort=function(){var d,b,a;this._build();b=this.length-1;for(d=this.heap;0<=b;)a=d[0],d[0]=d[b],d[b]=a,this.length-=1,this._heapify(0),b-=1;return null};b.prototype.peek=function(){return this.length?this.heap[0]:
null};b.prototype.pop=function(){var b,m;return this.length?(b=this.heap,m=b[0],b[0]=b[this.length-1],this.length-=1,this._heapify(0),m):null};b.prototype.push=function(b){var m,a,g,p,c;g=this.length;this.length+=1;c=this._parent;p=c(g);a=this.heap;for(m=this.compare;0<g&&0>m(a[p],b);)a[g]=a[p],g=p,p=c(g);a[g]=b;return null};b.prototype.clear=function(){this.length=this.heap.length=0;return null};return b}();l.vst||(l.vst={});l.vst.MaxHeap=e}).call(this);
(function(){var e,f,l,h,b,d,m,a,g,p={}.hasOwnProperty,c=function(c,k){function a(){this.constructor=c}for(var b in k)p.call(k,b)&&(c[b]=k[b]);a.prototype=k.prototype;c.prototype=new a;c.__super__=k.prototype;return c},k=[].slice;"undefined"!==typeof exports?(a=exports,e=require("./entity").vst.Entity,g=require("./predicates").vst.predicates,require("./functions")):"undefined"!==typeof window?(a=window,e=window.vst.Entity,g=window.vst.predicates):(a=this,e=this.vst.Entity,g=this.vst.predicates);l=
function(a){function g(){return g.__super__.constructor.apply(this,arguments)}c(g,a);g.prototype.Iterator=function(c){null==c&&(c=[]);c.push(g);return g.__super__.Iterator.call(this,c)};g.prototype.has_next=function(){this.advance();return null!==this.next_element()};g.prototype.peek=function(){this.advance();return this.next_element()};g.prototype.next=function(){var c;this.advance();c=this.next_element();this.next_element(null);return c};g.prototype.to_array=function(){var c;for(c=[];this.has_next();)c.push(this.next());
return c};g.prototype.mapref=function(){var c,a;a=arguments[0];c=2<=arguments.length?k.call(arguments,1):[];return this.map(function(){return this[a].apply(this,c)})};g.prototype.map=function(c){return h.of(this,c)};g.prototype.each=function(c){var k,a;for(a=0;this.has_next();){k=this.next();if(!1===c.call(k,k,a))return!1;a+=1}return!0};g.prototype.select=function(c){return b.of(this,c)};g.prototype.exclude=function(c){return f.of(this,c)};g.prototype.take=function(c){return d.of(this,c)};g.prototype.take_while=
function(c){return m.of(this,c)};g.prototype.drop=function(c){var k;for(k=-1;(k+=1)<c&&this.has_next();)this.next();return this};g.prototype.drop_while=function(c){var k;for(k=-1;(k+=1)<n&&this.has_next()&&c.call(this.peek(),this.peek());)this.next();return this};return g}(e);e.def_abstract_methods(l,{advance:{arity:0}});e.def_properties(l,{next_element:{initial_value:null}});g.is_instance(l);h=function(k){function a(c){null==c&&(c=[]);c.push(a);a.__super__.constructor.call(this,c)}c(a,k);a.of=function(c,
k){return(new a).iterator(c).fn(k)};a.prototype.advance=function(){var c;null===this.next_element()&&this.iterator().has_next()&&(c=this.iterator().next(),this.next_element(this.fn().call(c,c,this.i())),this.i(1+this.i()));return!0};return a}(l);e.def_properties(h,{iterator:{},fn:{},i:{initial_value:0}});e.def_toString(h);d=function(k){function a(c){null==c&&(c=[]);c.push(a);a.__super__.constructor.call(this,c)}c(a,k);a.of=function(c,k){return(new a).iterator(c).n(k)};a.prototype.advance=function(){null===
this.next_element()&&this.i()<this.n()&&this.next_element(this.iterator().next());return!0};return a}(l);e.def_properties(d,{iterator:{},n:{},i:{initial_value:0}});e.def_toString(d);m=function(k){function a(c){null==c&&(c=[]);c.push(a);a.__super__.constructor.call(this,c)}c(a,k);a.of=function(c,k){return(new a).iterator(c).n(k)};a.prototype.advance=function(){var c;null===this.next_element()&&this.iterator().has_next()&&(c=this.iterator().peek(),this.is_valid().call(c,c)&&this.next_element(this.iterator().next()));
return!0};return a}(l);e.def_properties(m,{iterator:{},is_valid:{}});e.def_toString(m);b=function(k){function a(c){null==c&&(c=[]);c.push(a);a.__super__.constructor.call(this,c)}c(a,k);a.of=function(c,k){return(new a).iterator(c).is_valid(k)};a.prototype.advance=function(){var c;if(null===this.next_element()){for(c=this.iterator().next();c&&!1===this.is_valid().call(c,c);)c=this.iterator().next();this.next_element(c)}return!0};return a}(l);e.def_properties(b,{iterator:{},is_valid:{}});e.def_toString(b);
f=function(k){function a(c){null==c&&(c=[]);c.push(a);a.__super__.constructor.call(this,c)}c(a,k);a.of=function(c,k){return(new a).iterator(c).is_valid(k)};a.prototype.advance=function(){var c;if(null===this.next_element()){for(c=this.iterator().next();c&&!0===this.is_valid().call(c,c);)c=this.iterator().next();this.next_element(c)}return!0};return a}(l);e.def_properties(f,{iterator:{},is_valid:{}});e.def_toString(f);a.vst||(a.vst={});a.vst.Iterator=l}).call(this);
(function(){var e,f,l,h,b={}.hasOwnProperty,d=function(d,a){function g(){this.constructor=d}for(var p in a)b.call(a,p)&&(d[p]=a[p]);g.prototype=a.prototype;d.prototype=new g;d.__super__=a.prototype;return d};"undefined"!==typeof exports?(l=exports,e=require("./entity").vst.Entity,h=require("./predicates").vst.predicates,require("./functions")):"undefined"!==typeof window?(l=window,e=window.vst.Entity,h=window.vst.predicates):(l=this,e=this.vst.Entity,h=this.vst.predicates);f=function(b){function a(b){null==
b&&(b=[]);b.push(a);a.__super__.constructor.call(this,b)}d(a,b);a.prototype.is_leaf=function(){return null===this.lesser_child()&&null===this.greater_child()};a.prototype.is_branch=function(){return!!this.lesser_child()^1===!!this.greater_child()};a.prototype.value=function(){if(0===this.values().length)return null;if(1===this.values().length)return this.values()[0];throw Error("There are multiple values, please use Node::values() instead.");};return a}(e);e.def_properties(f,{key:{},values:{init:function(){return[]}},
height:{initial_value:0},greater_child:{initial_value:null},lesser_child:{initial_value:null},greater_neighbor:{initial_value:null,stringify:!1},lesser_neighbor:{initial_value:null,stringify:!1}});h.is_instance(f);l.vst||(l.vst={});l.vst.Node=f}).call(this);
(function(){var e,f,l,h={}.hasOwnProperty,b=function(b,f){function a(){this.constructor=b}for(var g in f)h.call(f,g)&&(b[g]=f[g]);a.prototype=f.prototype;b.prototype=new a;b.__super__=f.prototype;return b};"undefined"!==typeof exports?(l=exports,e=require("./entity").vst.Entity,f=require("./iterator").vst.Iterator,require("./node"),require("./predicates")):"undefined"!==typeof window?(l=window,e=window.vst.Entity,f=window.vst.Iterator):(l=this,e=this.vst.Entity,f=this.vst.Iterator);f=function(d){function f(a){null==
a&&(a=[]);a.push(f);f.__super__.constructor.call(this,a)}b(f,d);f.of=function(a,b,d){return(new f).node(a).upper_key(b).comparator(d)};f.empty=function(){return this.of(null,-1,function(a,b){return 1})};f.prototype.advance=function(){null===this.next_element()&&this.node()&&0>=this.comparator()(this.node().key(),this.upper_key())&&(this.next_element(this.node()),this.node(this.node().greater_neighbor()));return!0};return f}(f);e.def_properties(f,{comparator:{},node:{},upper_key:{}});e.def_toString(f);
l.vst||(l.vst={});l.vst.RangeIterator=f}).call(this);
(function(){var e,f,l,h,b={}.hasOwnProperty,d=function(d,a){function g(){this.constructor=d}for(var f in a)b.call(a,f)&&(d[f]=a[f]);g.prototype=a.prototype;d.prototype=new g;d.__super__=a.prototype;return d};"undefined"!==typeof exports?(h=exports,e=require("./entity").vst.Entity,f=require("./iterator").vst.Iterator,require("./node"),require("./predicates"),require("./functions")):"undefined"!==typeof window?(h=window,e=window.vst.Entity,f=window.vst.Iterator):(h=this,e=this.vst.Entity,f=this.vst.Iterator);
l=function(b,a,d){var f,c,k,e,h;h=a.lesser_neighbor();for(e=a.greater_neighbor();;)if(h)if(e)if(f=d(a.key(),b),c=d(h.key(),b),k=d(e.key(),b),c<f)k<c?(a=e,e=e.greater_neighbor()):(a=h,h=h.lesser_neighbor());else if(k<f)a=e,e=e.greater_neighbor();else return a;else if(d(h.key(),b)<d(a.key(),b))a=h,h=h.lesser_neighbor();else return a;else if(e)if(d(e.key(),b)<d(a.key(),b))a=e,e=e.greater_neighbor();else return a;else return a};f=function(b){function a(b){null==b&&(b=[]);b.push(a);a.__super__.constructor.call(this,
b)}d(a,b);a.of=function(b,d,c,k){b=l(d,b,k);d=(new a).distance(k).key(d).k(c);0<c&&d.next_element(b).greater_neighbor(b.greater_neighbor()).lesser_neighbor(b.lesser_neighbor()).i(1);return d};a.empty=function(){return(new a).neighbors([])};a.prototype.advance=function(){var a,b;null===this.next_element()&&this.i()<this.k()&&(this.lesser_neighbor()?(this.greater_neighbor()?(b=this.distance()(this.lesser_neighbor().key(),this.key()),a=this.distance()(this.greater_neighbor().key(),this.key()),b<a?(this.next_element(this.lesser_neighbor()),
this.lesser_neighbor(this.lesser_neighbor().lesser_neighbor())):(this.next_element(this.greater_neighbor()),this.greater_neighbor(this.greater_neighbor().greater_neighbor()))):(this.next_element(this.lesser_neighbor()),this.lesser_neighbor(this.lesser_neighbor().lesser_neighbor())),this.i(1+this.i())):this.greater_neighbor()&&(this.next_element(this.greater_neighbor()),this.greater_neighbor(this.greater_neighbor().greater_neighbor()),this.i(1+this.i())));return!0};return a}(f);e.def_properties(f,
{node:{},lesser_neighbor:{},greater_neighbor:{},key:{},k:{},i:{initial_value:0},distance:{}});e.def_toString(f);h.vst||(h.vst={});h.vst.NearestNeighborIterator=f}).call(this);
(function(){var e,f,l,h,b,d,m={}.hasOwnProperty,a=function(a,b){function c(){this.constructor=a}for(var k in b)m.call(b,k)&&(a[k]=b[k]);c.prototype=b.prototype;a.prototype=new c;a.__super__=b.prototype;return a};"undefined"!==typeof exports?(b=exports,e=require("./entity").vst.Entity,require("./node"),l=require("./range_iterator").vst.RangeIterator,f=require("./nearest_neighbor_iterator").vst.NearestNeighborIterator,require("./max_heap"),d=require("./predicates").vst.predicates,require("./functions")):
"undefined"!==typeof window?(b=window,e=window.vst.Entity,l=window.vst.RangeIterator,f=window.vst.NearestNeighborIterator,d=window.vst.predicates):(b=this,e=this.vst.Entity,l=this.vst.RangeIterator,f=this.vst.NearestNeighborIterator,d=this.vst.predicates);h=function(b){function e(c){null==c&&(c=[]);c.push(e);e.__super__.constructor.call(this,c)}a(e,b);e.prototype.is_node_type=function(c){return c instanceof this.NodeType()};e.prototype.height=function(){return d.is_defined(this.root())?this.root().height():
0};e.prototype.greatest=function(c){null==c&&(c=this.root());if(null===c)return null;for(;c.greater_child();)c=c.greater_child();return c};e.prototype.least=function(c){null==c&&(c=this.root());if(null===c)return null;for(;c.lesser_child();)c=c.lesser_child();return c};e.prototype.try_insert=function(c,k){return d.is_null(this.root())?(this.root(this.NodeType().of(c,k)),this.size(this.size()+1),!0):!1===this.contains_key(c)?(this.add_descendant(this.root(),this.NodeType().of(c,k)),this.size(this.size()+
1),!0):!1};e.prototype.insert=function(c,k){var a;null===this.root()?this.root(this.NodeType().of(c,k)):(a=this.find(c))?a.values().push(k):this.add_descendant(this.root(),this.NodeType().of(c,k));this.size(this.size()+1);return this};e.prototype.contains_key=function(c){return null!==this.find(c)};e.prototype.find=function(c){var k,a;for(a=this.root();a;)if(k=this.comparator()(c,a.key()),0<k)a=a.greater_child();else if(0>k)a=a.lesser_child();else break;return a};e.prototype.find_nearest=function(c){var a,
b;for(b=this.root();b;)if(a=this.comparator()(c,b.key()),0<a){if(null===b.greater_child())break;b=b.greater_child()}else if(0>a){if(null===b.lesser_child())break;b=b.lesser_child()}else break;return b};e.prototype.find_nearest_gte=function(c){var a;for(a=this.find_nearest(c);a&&0>this.comparator()(a.key(),c);)a=a.greater_neighbor();return a};e.prototype.find_nearest_lte=function(c){var a;for(a=this.find_nearest(c);a&&0<this.comparator()(a.key(),c);)a=a.lesser_neighbor();return a};e.prototype.remove=
function(c,a){var b,e,g,f,h,l;if(g=this.find(c)){if(d.is_defined(a)){l=g.values();e=f=0;for(h=l.length;f<h;e=++f)if(b=l[e],b===a)return g.values().splice(e,1),0===g.values().length&&this.remove_node(g),this.size(this.size()-1),!0;return!1}this.size(this.size()-g.values().length);this.remove_node(g);return!0}return!1};e.prototype.preorder=function(c,a){null==a&&(a=this.root());a&&(c(a),a.lesser_child()&&this.preorder(c,a.lesser_child()),a.greater_child()&&this.preorder(c,a.greater_child()));return this};
e.prototype.inorder=function(c,a){null==a&&(a=this.root());a&&(a.lesser_child()&&this.inorder(c,a.lesser_child()),c(a),a.greater_child()&&this.inorder(c,a.greater_child()));return this};e.prototype.postorder=function(c,a){null==a&&(a=this.root());a&&(a.lesser_child()&&this.postorder(c,a.lesser_child()),a.greater_child()&&this.postorder(c,a.greater_child()),c(a));return this};e.prototype.range=function(c,a){var b;b=this.find_nearest_gte(c);return l.of(b,a,this.comparator())};e.prototype.neighbors=
function(c,a,b){var d,g,e;if(e=this.find_nearest(c)){d=this.comparator()(e.key(),c);if(c=0>d?e:e.lesser_neighbor())for(g=1;g<a&&c.lesser_neighbor();)c=c.lesser_neighbor(),g+=1;if(a=0<d?e:e.greater_neighbor())for(g=1;g<b&&a.greater_neighbor();)a=a.greater_neighbor(),g+=1;b=c||e;e=a?a.key():e.key();return l.of(b,e,this.comparator())}return l.empty()};e.prototype.nearest_neighbors=function(c,a,b){var d;return(d=this.find_nearest(c))?f.of(d,c,a,b):f.empty()};return e}(e);e.def_abstract_methods(h,{add_descendant:{arity:2},
remove_node:{arity:1}});e.def_properties(h,{comparator:{},size:{initial_value:0},NodeType:{},root:{initial_value:null}});b.vst||(b.vst={});b.vst.Tree=h}).call(this);
(function(){var e,f,l,h,b={}.hasOwnProperty,d=function(d,a){function g(){this.constructor=d}for(var e in a)b.call(a,e)&&(d[e]=a[e]);g.prototype=a.prototype;d.prototype=new g;d.__super__=a.prototype;return d};"undefined"!==typeof exports?(l=exports,f=require("./entity").vst.Entity,e=require("./node").vst.Node,h=require("./predicates").vst.predicates,require("./functions")):"undefined"!==typeof window?(l=window,f=window.vst.Entity,e=window.vst.Node,h=window.vst.predicates):(l=this,f=this.vst.Entity,
e=window.vst.Node,h=this.vst.predicates);e=function(b){function a(b){null==b&&(b=[]);if(!(this instanceof a))return new a(b);b.push(a);a.__super__.constructor.call(this,b)}d(a,b);a.of=function(b,d){var c;c=(new a).key(b);c.values().push(d);return c};a.prototype.max_child_height=function(){var a,b;b=this.lesser_child()?this.lesser_child().height():-1;a=this.greater_child()?this.greater_child().height():-1;return Math.max(b,a)};a.prototype.balance=function(){var a,b;b=this.lesser_child()?this.lesser_child().height():
-1;a=this.greater_child()?this.greater_child().height():-1;return b-a};a.prototype.is_balanced=function(){var a;return-1<=(a=this.balance())&&1>=a};return a}(e);h.is_instance(e);f.def_properties(e,{parent:{initial_value:null,stringify:!1}});f.def_toString(e);l.vst||(l.vst={});l.vst.AvlNode=e}).call(this);
(function(){var e,f,l,h,b,d,m={}.hasOwnProperty,a=function(a,b){function c(){this.constructor=a}for(var k in b)m.call(b,k)&&(a[k]=b[k]);c.prototype=b.prototype;a.prototype=new c;a.__super__=b.prototype;return a};"undefined"!==typeof exports?(b=exports,l=require("./entity").vst.Entity,e=require("./avl_node").vst.AvlNode,f=require("./tree").vst.Tree,d=require("./predicates").vst.predicates,h=require("./functions").vst.functions):"undefined"!==typeof window?(b=window,l=window.vst.Entity,e=window.vst.AvlNode,
f=window.vst.Tree,d=window.vst.predicates,h=window.vst.functions):(b=this,l=this.vst.Entity,e=this.vst.AvlNode,f=this.vst.Tree,d=this.vst.predicates,h=this.vst.functions);f=function(b){function f(c){null==c&&(c=[]);if(!(this instanceof f))return new f(c);c.push(f);f.__super__.constructor.call(this,c)}a(f,b);f.of=function(c){return(new f).NodeType(e).comparator(c)};f.prototype.greater_greater_case=function(c){var a;h=c.parent();a=c.greater_child();a.greater_child();c.greater_child(a.lesser_child());
c.greater_child()&&c.greater_child().parent(c);a.lesser_child(c);c.parent(a);h?(h.greater_child()===c?h.greater_child(a):h.lesser_child(a),a.parent(h)):(a.parent(null),this.root(a));this.recompute_heights(c);this.recompute_heights(a.parent());return this};f.prototype.greater_lesser_case=function(c){var a,b;h=c.parent();a=c.greater_child();b=a.lesser_child();a.lesser_child(b.greater_child());a.lesser_child()&&a.lesser_child().parent(a);c.greater_child(b.lesser_child());c.greater_child()&&c.greater_child().parent(c);
b.greater_child(a);a.parent(b);b.lesser_child(c);c.parent(b);h?(h.greater_child()===c?h.greater_child(b):h.lesser_child(b),b.parent(h)):(b.parent(null),this.root(b));this.recompute_heights(c);this.recompute_heights(a);return this};f.prototype.lesser_lesser_case=function(c){var a;h=c.parent();a=c.lesser_child();a.lesser_child();c.lesser_child(a.greater_child());c.lesser_child()&&c.lesser_child().parent(c);a.greater_child(c);c.parent(a);h?(h.greater_child()===c?h.greater_child(a):h.lesser_child(a),
a.parent(h)):(a.parent(null),this.root(a));this.recompute_heights(c);this.recompute_heights(a.parent());return this};f.prototype.lesser_greater_case=function(c){var a,b;h=c.parent();a=c.lesser_child();b=a.greater_child();c.lesser_child(b.greater_child());c.lesser_child()&&c.lesser_child().parent(c);a.greater_child(b.lesser_child());a.greater_child()&&a.greater_child().parent(a);b.lesser_child(a);a.parent(b);b.greater_child(c);c.parent(b);h?(h.greater_child()===c?h.greater_child(b):h.lesser_child(b),
b.parent(h)):(b.parent(null),this.root(b));this.recompute_heights(c);this.recompute_heights(a);return this};f.prototype.rebalance=function(a){var b;b=a.balance();-2>=b?0>=a.greater_child().balance()?this.greater_greater_case(a):this.greater_lesser_case(a):2<=b&&(0<=a.lesser_child().balance()?this.lesser_lesser_case(a):this.lesser_greater_case(a));return this};f.prototype.recompute_heights=function(a){var b;if(d.is_defined(a))for(b=!0;a&&b;)b=a.height(),a.height(a.greater_child()||a.lesser_child()?
1+a.max_child_height():0),b=a.height!==b,a=a.parent();return this};f.prototype.add_descendant=function(a,b){var d,e;e=this.comparator()(b.key(),a.key());d=null;0>e?d=this.add_lesser_child(a,b):0<e?d=this.add_greater_child(a,b):this.add_equivalent_child(b);d&&this.rebalance(d);return this};f.prototype.add_lesser_child=function(a,b){var d,e;b.greater_neighbor(a);d=null;if(a.lesser_child())this.add_descendant(a.lesser_child(),b);else if(a.lesser_child(b),b.parent(a),a.lesser_neighbor()&&a.lesser_neighbor().greater_neighbor(b),
a.lesser_neighbor(b),0===a.height())for(e=a;e;){e.height(1+e.max_child_height());if(!e.is_balanced()){d=e;break}e=e.parent()}return d};f.prototype.add_greater_child=function(a,b){var d,e;b.lesser_neighbor(a);d=null;if(a.greater_child())this.add_descendant(a.greater_child(),b);else if(a.greater_child(b),b.parent(a),a.greater_neighbor()&&a.greater_neighbor().lesser_neighbor(b),a.greater_neighbor(b),0===a.height())for(e=a;e;){e.height(1+e.max_child_height());if(!e.is_balanced()){d=e;break}e=e.parent()}return d};
f.prototype.add_equivalent_child=function(a,b){a.values(a.values().concat(b.values()));b.lesser_neighbor(null);b.greater_neighbor(null);b.lesser_child(null);b.greater_child(null);b.values().length=0;b.parent(null);return null};f.prototype.remove_node=function(a){a.values().length=0;a.lesser_neighbor()&&a.lesser_neighbor(a.greater_neighbor());a.greater_neighbor()&&a.greater_neighbor(a.lesser_neighbor());a.is_leaf()?this.remove_leaf(a):a.is_branch()?this.remove_branch(a):this.swap_and_remove(a);return this};
f.prototype.remove_leaf=function(a){var b;if(b=a.parent())for(b.lesser_child()===a?b.lesser_child(null):b.greater_child(null),this.recompute_heights(b);a=a.parent();)a.is_balanced()||this.rebalance(a);else this.root(null);return null};f.prototype.remove_branch=function(a){var b;if(b=a.parent())for(b.lesser_child()?b.lesser_child(a.greater_child()||a.lesser_child()):b.greater_child(a.greater_child()||a.lesser_child()),a.greater_child()?a.greater_child().parent(b):a.lesser_child().parent(b),this.recompute_heights(b);a=
a.parent();)a.is_balanced()||this.rebalance(a);return null};f.prototype.swap_and_remove=function(a){var b;b=this.least(a.greater_child());this.swap_nodes(a,b);0===a.height()?this.remove_leaf(a):this.remove_branch(a);return null};f.prototype.swap_nodes=function(a,b){var d,e,f,g,h,l,m;l=a.parent();g=a.lesser_child();d=a.greater_child();m=b.parent();h=b.lesser_child();e=b.greater_child();f=a.height();a.height(b.height());b.height(f);l?(l.lesser_child()===a?parent.lesser_child(b):parent.greater_child(b),
b.parent(parent)):(b.parent(null),this.root(b));b.lesser_child(g);g.parent(b);a.lesser_child(h);h.parent(a);e?e.parent(a):m!==a?(b.greater_child(d),d.parent(b),m.lesser_child(a),a.parent(m)):(b.greater_child(a),a.parent(b));return null};return f}(f);l.def_toString(f);b.vst||(b.vst={});b.vst.AvlTree=f}).call(this);
