/*

The MIT License (MIT)

Copyright (c) 2014 Dylon Edwards

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
*/
(function(){var k;k="undefined"!==typeof exports?exports:"undefined"!==typeof window?window:this;k.vst||(k.vst={});k.vst.comparators={c_number:function(h,c){return h-c},c_string_case_sensitive:function(h,c){return h.localeCompare(c)},c_string_case_insensitive:function(h,c){return h.toLowerCase().localeCompare(c.toLowerCase())}}}).call(this);
(function(){var k;k="undefined"!==typeof exports?exports:"undefined"!==typeof window?window:this;k.vst||(k.vst={});k.vst.metrics={m_number:function(h,c){return Math.abs(h-c)}}}).call(this);
(function(){var k,h,c,g,p=[].slice;h="undefined"!==typeof window?window:"undefined"!==typeof exports?exports:this;k=function(a,d){if(!c.is_boolean(a))throw Error("Expected truth="+a+" to be a boolean");if(!c.is_undefined(d)&&!c.is_string(d))throw Error("Expected message="+d+" to be a string");if(!1===a){if(d)throw Error("Assertion error: "+d);throw Error("Assertion error");}return!0};c=g={tautology:function(){return!0},contradiction:function(){return!1},is_number:function(a){return"number"===typeof a},
is_negative_number:function(a){return c.is_number(a)&&0>a},is_non_positive_number:function(a){return c.is_number(a)&&0>=a},is_non_negative_number:function(a){return c.is_number(a)&&0<=a},is_positive_number:function(a){return c.is_number(a)&&0<a},is_boolean:function(a){return"boolean"===typeof a},is_string:function(a){return"string"===typeof a},is_function:function(a){return"function"===typeof a},is_constructor:function(a){return c.is_function(a)&&c.is_object(a.prototype)},is_null:function(a){return null===
a},is_undefined:function(a){return void 0===a},is_defined:function(a){return!c.is_undefined(a)&&!c.is_null(a)},is_object:function(a){return"object"===typeof a&&!c.is_null(a)},is_array:function(a){return c.is_object(a)&&c.is_non_negative_number(a.length)},has_arity:function(a){k(c.is_non_negative_number(a));return function(d){return d.length===a}},is_instance:function(a){k(c.is_function(a));return function(d){return d instanceof a}},is_type:function(a){k(c.is_function(a));return function(d){return c.is_function(d)&&
d.prototype instanceof a}},is_bounded:function(a,d){k(c.is_number(a)&&c.is_number(d));return function(f){return c.is_number(f)&&a<=f&&f<=d}},is_lt:function(a){k(c.is_number(a));return function(d){return c.is_number(d)&&d<a}},is_lte:function(a){k(c.is_number(a));return function(d){return c.is_number(d)&&d<=a}},is_eq:function(a){k(c.is_number(a));return function(d){return c.is_number(d)&&d===a}},is_gte:function(a){k(c.is_number(a));return function(d){return c.is_number(d)&&d>=a}},is_gt:function(a){k(c.is_number(a));
return function(d){return c.is_number(d)&&d>a}},is_equal:function(a){return function(d){return d===a}},there_exists:function(a){k(c.is_function(a));return function(d){var f,q,l;k(c.is_array(d));q=0;for(l=d.length;q<l;q++)if(f=d[q],!0===a.call(this,f))return!0;return!1}},for_all:function(a){k(c.is_function(a));return function(d){var f,q,l;k(c.is_array(d));q=0;for(l=d.length;q<l;q++)if(f=d[q],!1===a.call(this,f))return!1;return!0}},disjoin:function(){var a,d,f;d=1<=arguments.length?p.call(arguments,
0):[];switch(d.length){case 0:return c.tautology;case 1:return a=d[0],function(f){return a.call(this,f)};case 2:return a=d[0],f=d[1],function(d){return a.call(this,d)||f.call(this,d)};default:return a=d[0],d=2<=d.length?p.call(d,1):[],f=c.disjoin.apply(null,d),function(d){return a.call(this,d)||f.call(this,d)}}},conjoin:function(){var a,d,f;d=1<=arguments.length?p.call(arguments,0):[];switch(d.length){case 0:return c.tautology;case 1:return a=d[0],function(f){return a.call(this,f)};case 2:return a=
d[0],f=d[1],function(d){return a.call(this,d)&&f.call(this,d)};default:return a=d[0],d=2<=d.length?p.call(d,1):[],f=c.conjoin.apply(null,d),function(d){return a.call(this,d)&&f.call(this,d)}}}};h.vst||(h.vst={});h.vst.predicates=g}).call(this);
(function(){var k,h,c,g,p=[].slice,a={}.hasOwnProperty;"undefined"!==typeof exports?(c=exports,g=require("./predicates").vst.predicates):"undefined"!==typeof window?(c=window,g=window.vst.predicates):(c=this,g=this.vst.predicates);k=h={assert:function(a,f){if(!g.is_boolean(a))throw Error("Expected truth="+k.to_string(a)+" to be a boolean");if(!g.is_undefined(f)&&!g.is_string(f))throw Error("Expected message="+k.to_string(f)+" to be a string");if(!1===a){if(g.is_undefined(f))throw Error("Assertion failed");
throw Error("Assertion failed: "+f);}},proxy:function(a,f){return function(){var q;q=1<=arguments.length?p.call(arguments,0):[];return a.apply(f,q)}},to_string:function(d){var f,q,l,b;if(g.is_null(d))return"null";if(g.is_undefined(d))return"undefined";if(g.is_array(d)){q=[];l=0;for(b=d.length;l<b;l++)f=d[l],q.push(k.to_string(f));return"["+q.join(", ")+"]"}if(g.is_object(d)){if(d.toString===Object.prototype.toString){f=[];for(q in d)a.call(d,q)&&(l=d[q],f.push(q+": "+k.to_string(l)));return"{"+f.join(", ")+
"}"}return d.toString()}return g.is_string(d)?'"'+d+'"':d.toString()}};c.vst||(c.vst={});c.vst.functions=h}).call(this);
(function(){var k,h,c,g,p,a,d,f,q={}.hasOwnProperty;"undefined"!==typeof exports?(c=exports,a=require("./predicates").vst.predicates,h=require("./functions").vst.functions):"undefined"!==typeof window?(c=window,a=window.vst.predicates,h=window.vst.functions):(c=this,a=this.vst.predicates,h=this.vst.functions);p=function(a,b){return function(e,m){if(!a.call(e,m))throw Error(""+h.to_string(m)+" is invalid for "+e.constructor.name+"."+b);return m}};d=function(f,b){return a.is_function(f[b])?f[b]():f[b]};
f=function(d){var b,e,m,s;if(d instanceof k)return d.validate();if(a.is_array(d)){s=[];e=0;for(m=d.length;e<m;e++)b=d[e],s.push(f(b));return s}if(a.is_object(d)){m=[];for(b in d)q.call(d,b)&&(e=d[b],m.push(f(e)));return m}return!0};k=function(){function l(b){var e,m,d,f,c,r,g,k;if(!a.is_array(b))throw Error("Expected "+h.to_string(b)+" to be an array");m={};r=0;for(g=b.length;r<g;r++)if(c=b[r],void 0!==c){if(!(a.is_function(c)&&c.prototype instanceof l&&this instanceof c))throw Error(""+c.name+" must be of type Entity");
if(c.__ABSTRACT_METHODS__)for(e in k=c.__ABSTRACT_METHODS__,k)q.call(k,e)&&(f=k[e],e[e]={type:c,attrs:f});c=c.__INITIALIZERS__;for(d in c)q.call(c,d)&&(f=c[d],this[d]=f.call(this,d))}this.__TYPE__=b=b[b.length-1];for(e in m)q.call(m,e)&&(d=m[e],b=d.type,d=d.attrs,d=d.arity,h.assert(a.is_method(this[e]),"Expected "+to_string(this)+" to implemented "+b.name+"::"+e),a.is_defined(d)&&h.assert(this[e].length>=d,"Expected "+to_string(h)+" to have an arity of at least "+d))}l.def_property=function(b,e,m){var d,
f,c,r,l,q,g,k;l=m.initial_value;c=m.get;r=m.init;q=m.is_valid;g=m.set;m=m.stringify;if(!a.is_function(b))throw Error(""+e+".ctor="+h.to_string(b)+" must be a function");if(!a.is_string(e))throw Error("property="+h.to_string(e)+" must be a string");if(!(a.is_function(q)&&1>=q.length))throw Error(""+e+".is_valid="+h.to_string(q)+" must be a function of arity <= 1");if(!(a.is_undefined(c)||a.is_function(c)&&1>=c.length))throw Error(""+e+".get="+h.to_string(c)+" must not be specified or must be a function of arity <= 1");
if(!(a.is_undefined(g)||a.is_function(g)&&1<=(k=g.length)&&2>=k))throw Error(""+e+".set="+h.to_string(g)+" must not be specified or must be a function of arity of 1 or 2");if(!(a.is_undefined(r)||a.is_function(r)&&1>=r.length))throw Error(""+e+".init="+h.to_string(r)+" must not be specified or must be a function of arity <= 1");if(!a.is_undefined(l)&&!q(l))throw Error(""+h.to_string(l)+" is invalid for "+e);if(!a.is_undefined(m)&&!a.is_boolean(m))throw Error("Expected "+e+".stringify="+h.to_string(m)+
" to be a boolean");c||(c=function(b){return this[b]});g||(g=function(b,e){return this[b]=e});1===g.length&&(g=function(b){return function(e,a){return b(a)}}(g));f="__"+e;d=p(q,e);a.is_undefined(l)||(b.prototype[f]=l);b.__INITIALIZERS__||(b.__INITIALIZERS__={});b.prototype[e]=function(b){var m;if(a.is_undefined(b)){this.__GET_CALLSTACK_SIZE__||(this.__GET_CALLSTACK_SIZE__={});(m=this.__GET_CALLSTACK_SIZE__)[e]||(m[e]=0);this.__GET_CALLSTACK_SIZE__[e]+=1;if(1<this.__GET_CALLSTACK_SIZE__[e])return this[f];
b=d(this,c.call(this,f));delete this.__GET_CALLSTACK_SIZE__[e];return b}d(this,b);g.call(this,f,b);return this};!1===m&&(b.prototype[e].__STRINGIFY__=!1);b.prototype[e].is_valid=q;b.__PROPERTIES__||(b.__PROPERTIES__=[]);b.__PROPERTIES__.push(e);b.properties||(b.properties=function(){return a.is_function(b.__super__.properties)?b.__super__.properties().concat(b.__PROPERTIES__):b.__PROPERTIES__});b.__VALIDATORS__||(b.__VALIDATORS__={});b.__VALIDATORS__[e]=q;r&&(b.__INITIALIZERS__[f]=r);return!0};l.def_properties=
function(b,e){var m,d,f;h.assert(a.is_function(b)&&g(b.prototype),"Expected "+b.name+"="+h.to_string(b)+" to inherit from Entity");h.assert(a.is_object(e));f=[];for(d in e)q.call(e,d)&&(m=e[d],f.push(this.def_property(b,d,m)));return f};l.def_abstract_method=function(b,e,m){m=m.arity;h.assert(a.is_undefined(m)||a.is_non_negative_number(m),"Expected arity="+h.to_string(m)+" to be a non-negative number");b.__ABSTRACT_METHODS__||(b.__ABSTRACT_METHODS__={});b.__ABSTRACT_METHODS__[e]={};if(a.is_defined(m))return b.__ABSTRACT_METHODS__[e].arity=
m};l.def_abstract_methods=function(b,e){var m,d,f;h.assert(a.is_function(b));h.assert(a.is_object(e));f=[];for(m in e)q.call(e,m)&&(d=e[m],f.push(this.def_abstract_method(b,m,d)));return f};l.find_property=function(b,e){h.assert(g(b.prototype));h.assert(a.is_string(e));return a.is_function(b.prototype[e])?b.prototype[e]:b.__super__&&g(b.__super__.prototype)?this.find_property(b.__super__,e):null};l.def_toString=function(b,e){var m,f,c,l,r,q;h.assert(a.is_function(b)&&g(b.prototype));h.assert(a.is_undefined(e)||
a.is_string(e));e||(e=b.name);m=[];q=b.properties();l=0;for(r=q.length;l<r;l++)c=q[l],(f=this.find_property(b,c))&&!1!==f.__STRINGIFY__&&m.push(c);b.prototype.toString=function(){var b,a,c,l;a=[];c=0;for(l=m.length;c<l;c++)f=m[c],b=d(this,f),a.push(f+": "+h.to_string(b));return""+e+" {"+a.join(", ")+"}"};return!0};l.prototype.validate=function(){var b,e,a,d;d=this.__TYPE__.__VALIDATORS__;for(e in d)if(q.call(d,e)){b=d[e];a=this[e]();if(!b.call(this,a))throw Error(""+h.to_string(a)+" is invalid for "+
e+" according to "+b+" for "+h.to_string(this));f(a)}return this};l.prototype.equals=function(b,e){var m,d,f,c;a.is_undefined(e)&&(e=b,b=this);if(g(b)){if(g(e)){c=b.constructor.properties();d=0;for(f=c.length;d<f;d++)if(m=c[d],!this.equals(b[m](),e[m]()))return!1;return!0}return!1}return b===e};return l}();g=a.is_instance(k);c.vst||(c.vst={});c.vst.Entity=k}).call(this);
(function(){var k,h,c,g;"undefined"!==typeof exports?(c=exports,g=require("./predicates").vst.predicates,h=require("./functions").vst.functions):"undefined"!==typeof window?(c=window,g=window.vst.predicates,h=window.vst.functions):(c=this,g=this.vst.predicates,h=this.vst.functions);k=function(){function c(a,d,f){this.compare=a;this.heap=null!=d?d:[];this.length=null!=f?f:this.heap.length;h.assert(g.is_array(this.heap));h.assert(g.is_bounded(0,this.heap.length)(this.length));h.assert(g.is_function(this.compare));
this._build()}c.prototype._parent=function(a){return 0<a?(a+1>>1)-1:0};c.prototype._left_child=function(a){return(a<<1)+1};c.prototype._right_child=function(a){return(a<<1)+2};c.prototype._heapify=function(a){var d,f,c;f=this._left_child(a);c=this._right_child(a);d=this.heap;f=f<this.length&&0<this.compare(d[f],d[a])?f:a;c<this.length&&0<this.compare(d[c],d[f])&&(f=c);f!==a&&(c=d[a],d[a]=d[f],d[f]=c,this._heapify(f));return null};c.prototype._build=function(){var a;for(a=this.length>>1;0<=a;)this._heapify(a),
a-=1;return null};c.prototype.increase_key=function(a,d){var f,c,l,b,e;f=this.compare;c=this.heap;if(0>f(d,c[a]))throw Error("Expected "+d+" to be at least heap["+a+"] = "+c[a]);c[a]=d;b=this._parent;for(l=b(a);a&&0>f(c[l],c[a]);)e=c[a],c[a]=c[l],c[l]=e,a=l,l=b(a);return null};c.prototype.sort=function(){var a,d,f;this._build();d=this.length-1;for(a=this.heap;0<=d;)f=a[0],a[0]=a[d],a[d]=f,this.length-=1,this._heapify(0),d-=1;return null};c.prototype.peek=function(){return this.length?this.heap[0]:
null};c.prototype.pop=function(){var a,d;return this.length?(a=this.heap,d=a[0],a[0]=a[this.length-1],this.length-=1,this._heapify(0),d):null};c.prototype.push=function(a){var d,f,c,l,b;c=this.length;this.length+=1;b=this._parent;l=b(c);f=this.heap;for(d=this.compare;0<c&&0>d(f[l],a);)f[c]=f[l],c=l,l=b(c);f[c]=a;return null};return c}();c.vst||(c.vst={});c.vst.MaxHeap=k}).call(this);
(function(){var k,h,c,g,p,a,d,f,q,l,b,e={}.hasOwnProperty,m=function(b,a){function m(){this.constructor=b}for(var d in a)e.call(a,d)&&(b[d]=a[d]);m.prototype=a.prototype;b.prototype=new m;b.__super__=a.prototype;return b},s=[].slice;"undefined"!==typeof exports?(q=exports,k=require("./entity").vst.Entity,b=require("./predicates").vst.predicates,f=require("./functions").vst.functions):"undefined"!==typeof window?(q=window,k=window.vst.Entity,b=window.vst.predicates,f=windwow.vst.functions):(q=this,
k=this.vst.Entity,b=this.vst.predicates,f=this.vst.functions);c=function(e){function c(){return c.__super__.constructor.apply(this,arguments)}m(c,e);c.prototype.Iterator=function(b){null==b&&(b=[]);if(this.constructor===c)throw Error("vst.Iterator should not be instantiated directly");if(0===b.length)throw Error("You must specify the subtype as an array to this constructor");b.push(c);return c.__super__.Iterator.call(this,b)};c.prototype.has_next=function(){this.advance();return null!==this.next_element()};
c.prototype.peek=function(){this.advance();return this.next_element()};c.prototype.next=function(){var b;this.advance();b=this.next_element();this.next_element(null);return b};c.prototype.to_array=function(){var b;for(b=[];this.has_next();)b.push(this.next());return b};c.prototype.mapref=function(){var b,e;e=arguments[0];b=2<=arguments.length?s.call(arguments,1):[];return this.map(function(){return this[e].apply(this,b)})};c.prototype.map=function(b){return g.of(this,b)};c.prototype.each=function(e){var a,
c;f.assert(b.is_function(e));for(c=0;this.has_next();)a=this.next(),e.call(a,a,c),c+=1;return this};c.prototype.select=function(b){return p.of(this,b)};c.prototype.exclude=function(b){return h.of(this,b)};c.prototype.take=function(b){return a.of(this,b)};c.prototype.take_while=function(b){return d.of(this,b)};c.prototype.drop=function(e){var a;f.assert(b.is_non_negative_number(e));for(a=-1;(a+=1)<e&&this.has_next();)this.next();return this};c.prototype.drop_while=function(e){var a;f.assert(b.is_function(e));
for(a=-1;(a+=1)<n&&this.has_next()&&e.call(this.peek(),this.peek());)this.next();return this};return c}(k);k.def_abstract_methods(c,{advance:{arity:0}});k.def_properties(c,{next_element:{initial_value:null,is_valid:b.tautology}});l=b.is_instance(c);g=function(e){function a(e){null==e&&(e=[]);f.assert(b.is_array(e));e.push(a);a.__super__.constructor.call(this,e)}m(a,e);a.of=function(b,e){return(new a).iterator(b).fn(e)};a.prototype.advance=function(){var b;null===this.next_element()&&this.iterator().has_next()&&
(b=this.iterator().next(),this.next_element(this.fn().call(b,b,this.i())),this.i(1+this.i()));return!0};return a}(c);k.def_properties(g,{iterator:{is_valid:l},fn:{is_valid:b.is_function},i:{is_valid:b.is_non_negative_number,initial_value:0}});k.def_toString(g);a=function(e){function a(e){null==e&&(e=[]);f.assert(b.is_array(e));e.push(a);a.__super__.constructor.call(this,e)}m(a,e);a.of=function(b,e){return(new a).iterator(b).n(e)};a.prototype.advance=function(){null===this.next_element()&&this.i()<
this.n()&&this.next_element(this.iterator().next());return!0};return a}(c);k.def_properties(a,{iterator:{is_valid:l},n:{is_valid:b.is_non_negative_number},i:{is_valid:b.is_non_negative_number,initial_value:0}});k.def_toString(a);d=function(e){function a(e){null==e&&(e=[]);f.assert(b.is_array(e));e.push(a);a.__super__.constructor.call(this,e)}m(a,e);a.of=function(b,e){return(new a).iterator(b).n(e)};a.prototype.advance=function(){var b;null===this.next_element()&&this.iterator().has_next()&&(b=this.iterator().peek(),
this.is_valid().call(b,b)&&this.next_element(this.iterator().next()));return!0};return a}(c);k.def_properties(d,{iterator:{is_valid:l},is_valid:{is_valid:b.is_function}});k.def_toString(d);p=function(e){function a(e){null==e&&(e=[]);f.assert(b.is_array(e));e.push(a);a.__super__.constructor.call(this,e)}m(a,e);a.of=function(b,e){return(new a).iterator(b).is_valid(e)};a.prototype.advance=function(){var b;if(null===this.next_element()){for(b=this.iterator().next();b&&!1===this.is_valid().call(b,b);)b=
this.iterator().next();this.next_element(b)}return!0};return a}(c);k.def_properties(p,{iterator:{is_valid:l},is_valid:{is_valid:b.is_function}});k.def_toString(p);h=function(e){function a(e){null==e&&(e=[]);f.assert(b.is_array(e));e.push(a);a.__super__.constructor.call(this,e)}m(a,e);a.of=function(b,e){return(new a).iterator(b).is_valid(e)};a.prototype.advance=function(){var b;if(null===this.next_element()){for(b=this.iterator().next();b&&!0===this.is_valid().call(b,b);)b=this.iterator().next();this.next_element(b)}return!0};
return a}(c);k.def_properties(h,{iterator:{is_valid:l},is_valid:{is_valid:b.is_function}});k.def_toString(h);q.vst||(q.vst={});q.vst.Iterator=c}).call(this);
(function(){var k,h,c,g,p={}.hasOwnProperty,a=function(a,c){function g(){this.constructor=a}for(var l in c)p.call(c,l)&&(a[l]=c[l]);g.prototype=c.prototype;a.prototype=new g;a.__super__=c.prototype;return a};"undefined"!==typeof exports?(c=exports,k=require("./entity").vst.Entity,g=require("./predicates").vst.predicates,require("./functions")):"undefined"!==typeof window?(c=window,k=window.vst.Entity,g=window.vst.predicates):(c=this,k=this.vst.Entity,g=this.vst.predicates);h=function(c){function f(a){null==
a&&(a=[]);if(this.constructor===f)throw Error("vst.Node should not be instantiated directly");if(0===a.length)throw Error("You must specify the subtype as an array to this constructor");a.push(f);f.__super__.constructor.call(this,a)}a(f,c);f.prototype.is_leaf=function(){return null===this.lesser_child()&&null===this.greater_child()};f.prototype.is_branch=function(){return!!this.lesser_child()^1===!!this.greater_child()};f.prototype.value=function(){if(0===this.values().length)return null;if(1===this.values().length)return this.values()[0];
throw Error("There are multiple values, please use Node::values() instead.");};return f}(k);k.def_properties(h,{key:{is_valid:g.tautology},values:{is_valid:g.is_array,init:function(){return[]}},height:{initial_value:0,is_valid:g.is_non_negative_number},greater_child:{initial_value:null,is_valid:g.disjoin(g.is_null,g.is_instance(h))},lesser_child:{initial_value:null,is_valid:g.disjoin(g.is_null,g.is_instance(h))},greater_neighbor:{initial_value:null,is_valid:g.disjoin(g.is_null,g.is_instance(h)),stringify:!1},
lesser_neighbor:{initial_value:null,is_valid:g.disjoin(g.is_null,g.is_instance(h)),stringify:!1}});g.is_instance(h);c.vst||(c.vst={});c.vst.Node=h}).call(this);
(function(){var k,h,c,g,p,a={}.hasOwnProperty,d=function(c,d){function l(){this.constructor=c}for(var b in d)a.call(d,b)&&(c[b]=d[b]);l.prototype=d.prototype;c.prototype=new l;c.__super__=d.prototype;return c};"undefined"!==typeof exports?(g=exports,k=require("./entity").vst.Entity,h=require("./iterator").vst.Iterator,c=require("./node").vst.Node,p=require("./predicates").vst.predicates):"undefined"!==typeof window?(g=window,k=window.vst.Entity,h=window.vst.Iterator,c=window.vst.Node,p=window.vst.predicates):
(g=this,k=this.vst.Entity,h=this.vst.Iterator,c=this.vst.Node,p=this.vst.predicates);h=function(a){function c(a){null==a&&(a=[]);if(!(this instanceof c))return new c(a);a.push(c);c.__super__.constructor.call(this,a)}d(c,a);c.of=function(a,b,e){return(new c).node(a).upper_key(b).comparator(e)};c.empty=function(){return this.of(null,-1,function(a,b){return 1})};c.prototype.advance=function(){null===this.next_element()&&this.node()&&0>=this.comparator()(this.node().key(),this.upper_key())&&(this.next_element(this.node()),
this.node(this.node().greater_neighbor()));return!0};return c}(h);k.def_properties(h,{comparator:{is_valid:p.conjoin(p.is_function,p.has_arity(2))},node:{is_valid:p.disjoin(p.is_null,p.is_instance(c))},upper_key:{is_valid:p.tautology}});k.def_toString(h);g.vst||(g.vst={});g.vst.RangeIterator=h}).call(this);
(function(){var k,h,c,g,p,a,d={}.hasOwnProperty,f=function(a,c){function b(){this.constructor=a}for(var e in c)d.call(c,e)&&(a[e]=c[e]);b.prototype=c.prototype;a.prototype=new b;a.__super__=c.prototype;return a};"undefined"!==typeof exports?(p=exports,k=require("./entity").vst.Entity,h=require("./iterator").vst.Iterator,c=require("./node").vst.Node,a=require("./predicates").vst.predicates,g=require("./functions").vst.functions):"undefined"!==typeof window?(p=window,k=window.vst.Entity,h=window.vst.Iterator,
c=window.vst.Node,a=window.vst.predicates,g=windwow.vst.functions):(p=this,k=this.vst.Entity,h=this.vst.Iterator,c=this.vst.Node,a=this.vst.predicates,g=this.vst.functions);h=function(c){function d(b){null==b&&(b=[]);g.assert(a.is_array(b));b.push(d);d.__super__.constructor.call(this,b)}f(d,c);d.of=function(b,a,c,f){a=(new d).distance(f).key(a).k(c);0<c&&a.next_element(b).greater_neighbor(b.greater_neighbor()).lesser_neighbor(b.lesser_neighbor()).i(1);return a};d.empty=function(){return(new d).neighbors([])};
d.prototype.advance=function(){var b,a;null===this.next_element()&&this.i()<this.k()&&(this.lesser_neighbor()?(this.greater_neighbor()?(a=this.distance()(this.lesser_neighbor().key(),this.key()),b=this.distance()(this.greater_neighbor().key(),this.key()),a<b?(this.next_element(this.lesser_neighbor()),this.lesser_neighbor(this.lesser_neighbor().lesser_neighbor())):(this.next_element(this.greater_neighbor()),this.greater_neighbor(this.greater_neighbor().greater_neighbor()))):(this.next_element(this.lesser_neighbor()),
this.lesser_neighbor(this.lesser_neighbor().lesser_neighbor())),this.i(1+this.i())):this.greater_neighbor()&&(this.next_element(this.greater_neighbor()),this.greater_neighbor(this.greater_neighbor().greater_neighbor()),this.i(1+this.i())));return!0};return d}(h);k.def_properties(h,{node:{is_valid:a.is_instance(c)},lesser_neighbor:{is_valid:a.disjoin(a.is_instance(c),a.is_null)},greater_neighbor:{is_valid:a.disjoin(a.is_instance(c),a.is_null)},key:{is_valid:a.is_defined},k:{is_valid:a.is_non_negative_number},
i:{is_valid:a.is_non_negative_number,initial_value:0},distance:{is_valid:a.is_function}});k.def_toString(h);p.vst||(p.vst={});p.vst.NearestNeighborIterator=h}).call(this);
(function(){var k,h,c,g,p,a,d,f,q={}.hasOwnProperty,l=function(b,a){function c(){this.constructor=b}for(var d in a)q.call(a,d)&&(b[d]=a[d]);c.prototype=a.prototype;b.prototype=new c;b.__super__=a.prototype;return b};"undefined"!==typeof exports?(d=exports,k=require("./entity").vst.Entity,c=require("./node").vst.Node,g=require("./range_iterator").vst.RangeIterator,h=require("./nearest_neighbor_iterator").vst.NearestNeighborIterator,require("./max_heap"),f=require("./predicates").vst.predicates,a=require("./functions").vst.functions):
"undefined"!==typeof window?(d=window,k=window.vst.Entity,c=window.vst.Node,g=window.vst.RangeIterator,h=window.vst.NearestNeighborIterator,f=window.vst.predicates,a=window.vst.functions):(d=this,k=this.vst.Entity,c=this.vst.Node,g=this.vst.RangeIterator,h=this.vst.NearestNeighborIterator,f=this.vst.predicates,a=this.vst.functions);p=function(b){function e(b){null==b&&(b=[]);if(this.constructor===e)throw Error("vst.Tree should not be instantiated directly");if(0===b.length)throw Error("You must specify the subtype as an array to this constructor");
b.push(e);e.__super__.constructor.call(this,b)}l(e,b);e.prototype.is_node_type=function(b){return b instanceof this.NodeType()};e.prototype.assert_is_node_type=function(b){return a.assert(this.is_node_type(b),"Expected "+a.to_string(b)+" to be a "+this.NodeType().name)};e.prototype.height=function(){return f.is_defined(this.root())?this.root().height():0};e.prototype.greatest=function(b){null==b&&(b=this.root());if(null===b)return null;for(this.assert_is_node_type(b);b.greater_child();)b=b.greater_child();
return b};e.prototype.least=function(b){null==b&&(b=this.root());if(null===b)return null;for(this.assert_is_node_type(b);b.lesser_child();)b=b.lesser_child();return b};e.prototype.try_insert=function(b,e){a.assert(f.is_defined(b));a.assert(f.is_defined(e));return f.is_null(this.root())?(this.root(this.NodeType().of(b,e)),this.size(this.size()+1),!0):!1===this.contains_key(b)?(this.add_descendant(this.root(),this.NodeType().of(b,e)),this.size(this.size()+1),!0):!1};e.prototype.insert=function(b,e){var c;
a.assert(f.is_defined(b));a.assert(f.is_defined(e));null===this.root()?this.root(this.NodeType().of(b,e)):(c=this.find(b))?c.values().push(e):this.add_descendant(this.root(),this.NodeType().of(b,e));this.size(this.size()+1);return this};e.prototype.contains_key=function(b){a.assert(f.is_defined(b));return null!==this.find(b)};e.prototype.find=function(b){var e,c;a.assert(f.is_defined(b));for(c=this.root();c;)if(e=this.comparator()(b,c.key()),0<e)c=c.greater_child();else if(0>e)c=c.lesser_child();
else break;return c};e.prototype.find_nearest=function(b){var e,c;a.assert(f.is_defined(b));for(c=this.root();c;)if(e=this.comparator()(b,c.key()),0<e){if(null===c.greater_child())break;c=c.greater_child()}else if(0>e){if(null===c.lesser_child())break;c=c.lesser_child()}else break;return c};e.prototype.find_nearest_gte=function(b){var e;a.assert(f.is_defined(b));for(e=this.find_nearest(b);e&&0>this.comparator()(e.key(),b);)e=e.greater_neighbor();return e};e.prototype.find_nearest_lte=function(b){var e;
a.assert(f.is_defined(b));for(e=this.find_nearest(b);e&&0<this.comparator()(e.key(),b);)e=e.lesser_neighbor();return e};e.prototype.remove=function(b,e){var c,d,g,l,h,k;a.assert(f.is_defined(b));if(g=this.find(b)){if(f.is_defined(e)){k=g.values();d=l=0;for(h=k.length;l<h;d=++l)if(c=k[d],c===e)return g.values().splice(d,1),0===g.values().length&&this.remove_node(g),this.size(this.size()-1),!0;return!1}this.size(this.size()-g.values().length);this.remove_node(g);return!0}return!1};e.prototype.preorder=
function(b,a){null==a&&(a=this.root());a&&(b(a),a.lesser_child()&&this.preorder(b,a.lesser_child()),a.greater_child()&&this.preorder(b,a.greater_child()));return this};e.prototype.inorder=function(b,a){null==a&&(a=this.root());a&&(a.lesser_child()&&this.inorder(b,a.lesser_child()),b(a),a.greater_child()&&this.inorder(b,a.greater_child()));return this};e.prototype.postorder=function(b,a){null==a&&(a=this.root());a&&(a.lesser_child()&&this.postorder(b,a.lesser_child()),a.greater_child()&&this.postorder(b,
a.greater_child()),b(a));return this};e.prototype.range=function(b,e){var c;a.assert(0>=this.comparator()(b,e),"Expected lower:"+a.to_string(b)+" <= upper:"+a.to_string(e));c=this.find_nearest_gte(b);return g.of(c,e,this.comparator())};e.prototype.neighbors=function(b,e,c){var d,l,h;a.assert(f.is_defined(b));a.assert(f.is_non_negative_number(e));a.assert(f.is_non_negative_number(c));if(h=this.find_nearest(b)){d=this.comparator()(h.key(),b);if(b=0>d?h:h.lesser_neighbor())for(l=1;l<e&&b.lesser_neighbor();)b=
b.lesser_neighbor(),l+=1;if(e=0<d?h:h.greater_neighbor())for(l=1;l<c&&e.greater_neighbor();)e=e.greater_neighbor(),l+=1;c=b||h;h=(null!=e?e.key():void 0)||h.key();return g.of(c,h,this.comparator())}return g.empty()};e.prototype.nearest_neighbors=function(b,e,c){var d;a.assert(f.is_defined(b));a.assert(f.is_non_negative_number(e));a.assert(f.is_function(c)&&2===c.length);return(d=this.find_nearest(b))?h.of(d,b,e,c):h.empty()};return e}(k);k.def_abstract_methods(p,{add_descendant:{arity:2},remove_node:{arity:1}});
k.def_properties(p,{comparator:{is_valid:f.disjoin(f.conjoin(f.is_function,f.has_arity(2)),f.is_undefined)},size:{initial_value:0,is_valid:f.is_non_negative_number},NodeType:{is_valid:f.disjoin(f.is_type(c),f.is_undefined)},root:{initial_value:null,is_valid:f.disjoin(f.is_null,f.conjoin(f.is_instance(c),p.prototype.is_node_type))}});d.vst||(d.vst={});d.vst.Tree=p}).call(this);
(function(){var k,h,c,g,p,a={}.hasOwnProperty,d=function(c,d){function g(){this.constructor=c}for(var b in d)a.call(d,b)&&(c[b]=d[b]);g.prototype=d.prototype;c.prototype=new g;c.__super__=d.prototype;return c};"undefined"!==typeof exports?(c=exports,h=require("./entity").vst.Entity,k=require("./node").vst.Node,p=require("./predicates").vst.predicates,require("./functions")):"undefined"!==typeof window?(c=window,h=window.vst.Entity,k=window.vst.Node,p=window.vst.predicates):(c=this,h=this.vst.Entity,
k=window.vst.Node,p=this.vst.predicates);k=function(a){function c(a){null==a&&(a=[]);if(!(this instanceof c))return new c(a);a.push(c);c.__super__.constructor.call(this,a)}d(c,a);c.of=function(a,b){var e;e=(new c).key(a);e.values().push(b);return e};c.prototype.max_child_height=function(){var a,b;b=this.lesser_child()?this.lesser_child().height():-1;a=this.greater_child()?this.greater_child().height():-1;return Math.max(b,a)};c.prototype.balance=function(){var a,b;b=this.lesser_child()?this.lesser_child().height():
-1;a=this.greater_child()?this.greater_child().height():-1;return b-a};c.prototype.is_balanced=function(){var a;return-1<=(a=this.balance())&&1>=a};return c}(k);g=p.is_instance(k);h.def_properties(k,{parent:{initial_value:null,is_valid:p.disjoin(g,p.is_null),stringify:!1}});h.def_toString(k);c.vst||(c.vst={});c.vst.AvlNode=k}).call(this);
(function(){var k,h,c,g,p,a,d={}.hasOwnProperty,f=function(a,c){function b(){this.constructor=a}for(var e in c)d.call(c,e)&&(a[e]=c[e]);b.prototype=c.prototype;a.prototype=new b;a.__super__=c.prototype;return a};"undefined"!==typeof exports?(p=exports,c=require("./entity").vst.Entity,k=require("./avl_node").vst.AvlNode,h=require("./tree").vst.Tree,a=require("./predicates").vst.predicates,g=require("./functions").vst.functions):"undefined"!==typeof window?(p=window,c=window.vst.Entity,k=window.vst.AvlNode,
h=window.vst.Tree,a=window.vst.predicates,g=window.vst.functions):(p=this,c=this.vst.Entity,k=this.vst.AvlNode,h=this.vst.Tree,a=this.vst.predicates,g=this.vst.functions);h=function(c){function d(b){null==b&&(b=[]);if(!(this instanceof d))return new d(b);b.push(d);d.__super__.constructor.call(this,b)}f(d,c);d.of=function(b){return(new d).NodeType(k).comparator(b)};d.prototype.greater_greater_case=function(b){var a;this.assert_is_node_type(b);g=b.parent();a=b.greater_child();a.greater_child();b.greater_child(a.lesser_child());
b.greater_child()&&b.greater_child().parent(b);a.lesser_child(b);b.parent(a);g?(g.greater_child()===b?g.greater_child(a):g.lesser_child(a),a.parent(g)):(a.parent(null),this.root(a));this.recompute_heights(b);this.recompute_heights(a.parent());return this};d.prototype.greater_lesser_case=function(b){var a,c;this.assert_is_node_type(b);g=b.parent();a=b.greater_child();c=a.lesser_child();a.lesser_child(c.greater_child());a.lesser_child()&&a.lesser_child().parent(a);b.greater_child(c.lesser_child());
b.greater_child()&&b.greater_child().parent(b);c.greater_child(a);a.parent(c);c.lesser_child(b);b.parent(c);g?(g.greater_child()===b?g.greater_child(c):g.lesser_child(c),c.parent(g)):(c.parent(null),this.root(c));this.recompute_heights(b);this.recompute_heights(a);return this};d.prototype.lesser_lesser_case=function(b){var a;this.assert_is_node_type(b);g=b.parent();a=b.lesser_child();a.lesser_child();b.lesser_child(a.greater_child());b.lesser_child()&&b.lesser_child().parent(b);a.greater_child(b);
b.parent(a);g?(g.greater_child()===b?g.greater_child(a):g.lesser_child(a),a.parent(g)):(a.parent(null),this.root(a));this.recompute_heights(b);this.recompute_heights(a.parent());return this};d.prototype.lesser_greater_case=function(b){var a,c;this.assert_is_node_type(b);g=b.parent();a=b.lesser_child();c=a.greater_child();b.lesser_child(c.greater_child());b.lesser_child()&&b.lesser_child().parent(b);a.greater_child(c.lesser_child());a.greater_child()&&a.greater_child().parent(a);c.lesser_child(a);
a.parent(c);c.greater_child(b);b.parent(c);g?(g.greater_child()===b?g.greater_child(c):g.lesser_child(c),c.parent(g)):(c.parent(null),this.root(c));this.recompute_heights(b);this.recompute_heights(a);return this};d.prototype.rebalance=function(b){var a;this.assert_is_node_type(b);a=b.balance();-2>=a?0>=b.greater_child().balance()?this.greater_greater_case(b):this.greater_lesser_case(b):2<=a&&(0<=b.lesser_child().balance()?this.lesser_lesser_case(b):this.lesser_greater_case(b));return this};d.prototype.recompute_heights=
function(b){var c;if(a.is_defined(b))for(this.assert_is_node_type(b),c=!0;b&&c;)c=b.height(),b.height(b.greater_child()||b.lesser_child()?1+b.max_child_height():0),c=b.height!==c,b=b.parent();return this};d.prototype.add_descendant=function(b,a){var c,d;this.assert_is_node_type(b);this.assert_is_node_type(a);d=this.comparator()(a.key(),b.key());c=null;0>d?c=this.add_lesser_child(b,a):0<d?c=this.add_greater_child(b,a):this.add_equivalent_child(a);c&&this.rebalance(c);return this};d.prototype.add_lesser_child=
function(b,a){var c,d;this.assert_is_node_type(b);this.assert_is_node_type(a);a.greater_neighbor(b);c=null;if(b.lesser_child())this.add_descendant(b.lesser_child(),a);else if(b.lesser_child(a),a.parent(b),b.lesser_neighbor()&&b.lesser_neighbor().greater_neighbor(a),b.lesser_neighbor(a),0===b.height())for(d=b;d;){d.height(1+d.max_child_height());if(!d.is_balanced()){c=d;break}d=d.parent()}return c};d.prototype.add_greater_child=function(b,a){var c,d;this.assert_is_node_type(b);this.assert_is_node_type(a);
a.lesser_neighbor(b);c=null;if(b.greater_child())this.add_descendant(b.greater_child(),a);else if(b.greater_child(a),a.parent(b),b.greater_neighbor()&&b.greater_neighbor().lesser_neighbor(a),b.greater_neighbor(a),0===b.height())for(d=b;d;){d.height(1+d.max_child_height());if(!d.is_balanced()){c=d;break}d=d.parent()}return c};d.prototype.add_equivalent_child=function(b,a){this.assert_is_node_type(b);this.assert_is_node_type(a);b.values(b.values().concat(a.values()));a.lesser_neighbor(null);a.greater_neighbor(null);
a.lesser_child(null);a.greater_child(null);a.values().length=0;a.parent(null);return null};d.prototype.remove_node=function(b){this.assert_is_node_type(b);b.values().length=0;b.lesser_neighbor()&&b.lesser_neighbor(b.greater_neighbor());b.greater_neighbor()&&b.greater_neighbor(b.lesser_neighbor());b.is_leaf()?this.remove_leaf(b):b.is_branch()?this.remove_branch(b):this.swap_and_remove(b);return this};d.prototype.remove_leaf=function(b){var a;this.assert_is_node_type(b);if(a=b.parent())for(a.lesser_child()===
b?a.lesser_child(null):a.greater_child(null),this.recompute_heights(a);b=b.parent();)b.is_balanced()||this.rebalance(b);else this.root(null);return null};d.prototype.remove_branch=function(b){var a;this.assert_is_node_type(b);if(a=b.parent())for(a.lesser_child()?a.lesser_child(b.greater_child()||b.lesser_child()):a.greater_child(b.greater_child()||b.lesser_child()),b.greater_child()?b.greater_child().parent(a):b.lesser_child().parent(a),this.recompute_heights(a);b=b.parent();)b.is_balanced()||this.rebalance(b);
return null};d.prototype.swap_and_remove=function(a){var c;this.assert_is_node_type(a);c=this.least(a.greater_child());this.swap_nodes(a,c);0===a.height()?this.remove_leaf(a):this.remove_branch(a);return null};d.prototype.swap_nodes=function(a,c){var d,f,g,h,k,l,p;this.assert_is_node_type(a);this.assert_is_node_type(c);l=a.parent();h=a.lesser_child();d=a.greater_child();p=c.parent();k=c.lesser_child();f=c.greater_child();g=a.height();a.height(c.height());c.height(g);l?(l.lesser_child()===a?parent.lesser_child(c):
parent.greater_child(c),c.parent(parent)):(c.parent(null),this.root(c));c.lesser_child(h);h.parent(c);a.lesser_child(k);k.parent(a);f?f.parent(a):p!==a?(c.greater_child(d),d.parent(c),p.lesser_child(a),a.parent(p)):(c.greater_child(a),a.parent(c));return null};return d}(h);c.def_toString(h);p.vst||(p.vst={});p.vst.AvlTree=h}).call(this);
