/*

The MIT License (MIT)

Copyright (c) 2014 Dylon Edwards

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
*/
(function(){var k;k="undefined"!==typeof exports?exports:"undefined"!==typeof window?window:this;k.vst||(k.vst={});k.vst.comparators={c_number:function(h,c){return h-c},c_string_case_sensitive:function(h,c){return h.localeCompare(c)},c_string_case_insensitive:function(h,c){return h.toLowerCase().localeCompare(c.toLowerCase())}}}).call(this);
(function(){var k;k="undefined"!==typeof exports?exports:"undefined"!==typeof window?window:this;k.vst||(k.vst={});k.vst.metrics={m_number:function(h,c){return Math.abs(h-c)}}}).call(this);
(function(){var k,h,c,f,p=[].slice;h="undefined"!==typeof window?window:"undefined"!==typeof exports?exports:this;k=function(a,d){if(!c.is_boolean(a))throw Error("Expected truth="+a+" to be a boolean");if(!c.is_undefined(d)&&!c.is_string(d))throw Error("Expected message="+d+" to be a string");if(!1===a){if(d)throw Error("Assertion error: "+d);throw Error("Assertion error");}return!0};c=f={tautology:function(){return!0},contradiction:function(){return!1},is_number:function(a){return"number"===typeof a},
is_negative_number:function(a){return c.is_number(a)&&0>a},is_non_positive_number:function(a){return c.is_number(a)&&0>=a},is_non_negative_number:function(a){return c.is_number(a)&&0<=a},is_positive_number:function(a){return c.is_number(a)&&0<a},is_boolean:function(a){return"boolean"===typeof a},is_string:function(a){return"string"===typeof a},is_function:function(a){return"function"===typeof a},is_constructor:function(a){return c.is_function(a)&&c.is_object(a.prototype)},is_null:function(a){return null===
a},is_undefined:function(a){return void 0===a},is_defined:function(a){return!c.is_undefined(a)&&!c.is_null(a)},is_object:function(a){return"object"===typeof a&&!c.is_null(a)},is_array:function(a){return c.is_object(a)&&c.is_non_negative_number(a.length)},has_arity:function(a){k(c.is_non_negative_number(a));return function(d){return d.length===a}},is_instance:function(a){k(c.is_function(a));return function(d){return d instanceof a}},is_type:function(a){k(c.is_function(a));return function(d){return c.is_function(d)&&
d.prototype instanceof a}},is_bounded:function(a,d){k(c.is_number(a)&&c.is_number(d));return function(g){return c.is_number(g)&&a<=g&&g<=d}},is_lt:function(a){k(c.is_number(a));return function(d){return c.is_number(d)&&d<a}},is_lte:function(a){k(c.is_number(a));return function(d){return c.is_number(d)&&d<=a}},is_eq:function(a){k(c.is_number(a));return function(d){return c.is_number(d)&&d===a}},is_gte:function(a){k(c.is_number(a));return function(d){return c.is_number(d)&&d>=a}},is_gt:function(a){k(c.is_number(a));
return function(d){return c.is_number(d)&&d>a}},is_equal:function(a){return function(d){return d===a}},there_exists:function(a){k(c.is_function(a));return function(d){var g,q,m;k(c.is_array(d));q=0;for(m=d.length;q<m;q++)if(g=d[q],!0===a.call(this,g))return!0;return!1}},for_all:function(a){k(c.is_function(a));return function(d){var g,q,m;k(c.is_array(d));q=0;for(m=d.length;q<m;q++)if(g=d[q],!1===a.call(this,g))return!1;return!0}},disjoin:function(){var a,d,g;d=1<=arguments.length?p.call(arguments,
0):[];switch(d.length){case 0:return c.tautology;case 1:return a=d[0],function(d){return a.call(this,d)};case 2:return a=d[0],g=d[1],function(d){return a.call(this,d)||g.call(this,d)};default:return a=d[0],d=2<=d.length?p.call(d,1):[],g=c.disjoin.apply(null,d),function(d){return a.call(this,d)||g.call(this,d)}}},conjoin:function(){var a,d,g;d=1<=arguments.length?p.call(arguments,0):[];switch(d.length){case 0:return c.tautology;case 1:return a=d[0],function(d){return a.call(this,d)};case 2:return a=
d[0],g=d[1],function(d){return a.call(this,d)&&g.call(this,d)};default:return a=d[0],d=2<=d.length?p.call(d,1):[],g=c.conjoin.apply(null,d),function(d){return a.call(this,d)&&g.call(this,d)}}}};h.vst||(h.vst={});h.vst.predicates=f}).call(this);
(function(){var k,h,c,f,p=[].slice,a={}.hasOwnProperty;"undefined"!==typeof exports?(c=exports,f=require("./predicates").vst.predicates):"undefined"!==typeof window?(c=window,f=window.vst.predicates):(c=this,f=this.vst.predicates);k=h={assert:function(a,g){if(!f.is_boolean(a))throw Error("Expected truth="+k.to_string(a)+" to be a boolean");if(!f.is_undefined(g)&&!f.is_string(g))throw Error("Expected message="+k.to_string(g)+" to be a string");if(!1===a){if(f.is_undefined(g))throw Error("Assertion failed");
throw Error("Assertion failed: "+g);}},proxy:function(a,g){return function(){var c;c=1<=arguments.length?p.call(arguments,0):[];return a.apply(g,c)}},to_string:function(d){var g,c,m,b;if(f.is_null(d))return"null";if(f.is_undefined(d))return"undefined";if(f.is_array(d)){c=[];m=0;for(b=d.length;m<b;m++)g=d[m],c.push(k.to_string(g));return"["+c.join(", ")+"]"}if(f.is_object(d)){if(d.toString===Object.prototype.toString){g=[];for(c in d)a.call(d,c)&&(m=d[c],g.push(c+": "+k.to_string(m)));return"{"+g.join(", ")+
"}"}return d.toString()}return f.is_string(d)?'"'+d+'"':d.toString()}};c.vst||(c.vst={});c.vst.functions=h}).call(this);
(function(){var k,h,c,f,p,a,d,g,q={}.hasOwnProperty;"undefined"!==typeof exports?(c=exports,a=require("./predicates").vst.predicates,h=require("./functions").vst.functions):"undefined"!==typeof window?(c=window,a=window.vst.predicates,h=window.vst.functions):(c=this,a=this.vst.predicates,h=this.vst.functions);p=function(a,b){return function(e,l){if(!a.call(e,l))throw Error(""+h.to_string(l)+" is invalid for "+e.constructor.name+"."+b);return l}};d=function(d,b){return a.is_function(d[b])?d[b]():d[b]};
g=function(d){var b,e,l,t;if(d instanceof k)return d.validate();if(a.is_array(d)){t=[];e=0;for(l=d.length;e<l;e++)b=d[e],t.push(g(b));return t}if(a.is_object(d)){l=[];for(b in d)q.call(d,b)&&(e=d[b],l.push(g(e)));return l}return!0};k=function(){function c(b){var e,l,d,g,s,r,f,k;if(!a.is_array(b))throw Error("Expected "+h.to_string(b)+" to be an array");l={};r=0;for(f=b.length;r<f;r++)if(s=b[r],void 0!==s){if(!(a.is_function(s)&&s.prototype instanceof c&&this instanceof s))throw Error(""+s.name+" must be of type Entity");
if(s.__ABSTRACT_METHODS__)for(e in k=s.__ABSTRACT_METHODS__,k)q.call(k,e)&&(g=k[e],e[e]={type:s,attrs:g});s=s.__INITIALIZERS__;for(d in s)q.call(s,d)&&(g=s[d],this[d]=g.call(this,d))}this.__TYPE__=b=b[b.length-1];for(e in l)q.call(l,e)&&(d=l[e],b=d.type,d=d.attrs,d=d.arity,h.assert(a.is_method(this[e]),"Expected "+to_string(this)+" to implemented "+b.name+"::"+e),a.is_defined(d)&&h.assert(this[e].length>=d,"Expected "+to_string(h)+" to have an arity of at least "+d))}c.def_property=function(b,e,l){var d,
g,c,r,m,f,q,k;m=l.initial_value;c=l.get;r=l.init;f=l.is_valid;q=l.set;l=l.stringify;if(!a.is_function(b))throw Error(""+e+".ctor="+h.to_string(b)+" must be a function");if(!a.is_string(e))throw Error("property="+h.to_string(e)+" must be a string");if(!(a.is_function(f)&&1>=f.length))throw Error(""+e+".is_valid="+h.to_string(f)+" must be a function of arity <= 1");if(!(a.is_undefined(c)||a.is_function(c)&&1>=c.length))throw Error(""+e+".get="+h.to_string(c)+" must not be specified or must be a function of arity <= 1");
if(!(a.is_undefined(q)||a.is_function(q)&&1<=(k=q.length)&&2>=k))throw Error(""+e+".set="+h.to_string(q)+" must not be specified or must be a function of arity of 1 or 2");if(!(a.is_undefined(r)||a.is_function(r)&&1>=r.length))throw Error(""+e+".init="+h.to_string(r)+" must not be specified or must be a function of arity <= 1");if(!a.is_undefined(m)&&!f(m))throw Error(""+h.to_string(m)+" is invalid for "+e);if(!a.is_undefined(l)&&!a.is_boolean(l))throw Error("Expected "+e+".stringify="+h.to_string(l)+
" to be a boolean");c||(c=function(b){return this[b]});q||(q=function(b,e){return this[b]=e});1===q.length&&(q=function(b){return function(e,a){return b(a)}}(q));g="__"+e;d=p(f,e);a.is_undefined(m)||(b.prototype[g]=m);b.__INITIALIZERS__||(b.__INITIALIZERS__={});b.prototype[e]=function(b){var l;if(a.is_undefined(b)){this.__GET_CALLSTACK_SIZE__||(this.__GET_CALLSTACK_SIZE__={});(l=this.__GET_CALLSTACK_SIZE__)[e]||(l[e]=0);this.__GET_CALLSTACK_SIZE__[e]+=1;if(1<this.__GET_CALLSTACK_SIZE__[e])return this[g];
b=d(this,c.call(this,g));delete this.__GET_CALLSTACK_SIZE__[e];return b}d(this,b);q.call(this,g,b);return this};!1===l&&(b.prototype[e].__STRINGIFY__=!1);b.prototype[e].is_valid=f;b.__PROPERTIES__||(b.__PROPERTIES__=[]);b.__PROPERTIES__.push(e);b.properties||(b.properties=function(){return a.is_function(b.__super__.properties)?b.__super__.properties().concat(b.__PROPERTIES__):b.__PROPERTIES__});b.__VALIDATORS__||(b.__VALIDATORS__={});b.__VALIDATORS__[e]=f;r&&(b.__INITIALIZERS__[g]=r);return!0};c.def_properties=
function(b,e){var l,d,g;h.assert(a.is_function(b)&&f(b.prototype),"Expected "+b.name+"="+h.to_string(b)+" to inherit from Entity");h.assert(a.is_object(e));g=[];for(d in e)q.call(e,d)&&(l=e[d],g.push(this.def_property(b,d,l)));return g};c.def_abstract_method=function(b,e,l){l=l.arity;h.assert(a.is_undefined(l)||a.is_non_negative_number(l),"Expected arity="+h.to_string(l)+" to be a non-negative number");b.__ABSTRACT_METHODS__||(b.__ABSTRACT_METHODS__={});b.__ABSTRACT_METHODS__[e]={};if(a.is_defined(l))return b.__ABSTRACT_METHODS__[e].arity=
l};c.def_abstract_methods=function(b,e){var l,d,g;h.assert(a.is_function(b));h.assert(a.is_object(e));g=[];for(l in e)q.call(e,l)&&(d=e[l],g.push(this.def_abstract_method(b,l,d)));return g};c.find_property=function(b,e){h.assert(f(b.prototype));h.assert(a.is_string(e));return a.is_function(b.prototype[e])?b.prototype[e]:b.__super__&&f(b.__super__.prototype)?this.find_property(b.__super__,e):null};c.def_toString=function(b,e){var l,g,c,m,r,q;h.assert(a.is_function(b)&&f(b.prototype));h.assert(a.is_undefined(e)||
a.is_string(e));e||(e=b.name);l=[];q=b.properties();m=0;for(r=q.length;m<r;m++)c=q[m],(g=this.find_property(b,c))&&!1!==g.__STRINGIFY__&&l.push(c);b.prototype.toString=function(){var b,a,c,r;a=[];c=0;for(r=l.length;c<r;c++)g=l[c],b=d(this,g),a.push(g+": "+h.to_string(b));return""+e+" {"+a.join(", ")+"}"};return!0};c.prototype.validate=function(){var b,e,a,d;d=this.__TYPE__.__VALIDATORS__;for(e in d)if(q.call(d,e)){b=d[e];a=this[e]();if(!b.call(this,a))throw Error(""+h.to_string(a)+" is invalid for "+
e+" according to "+b+" for "+h.to_string(this));g(a)}return this};c.prototype.equals=function(b,e){var d,g,c,m;a.is_undefined(e)&&(e=b,b=this);if(f(b)){if(f(e)){m=b.constructor.properties();g=0;for(c=m.length;g<c;g++)if(d=m[g],!this.equals(b[d](),e[d]()))return!1;return!0}return!1}return b===e};return c}();f=a.is_instance(k);c.vst||(c.vst={});c.vst.Entity=k}).call(this);
(function(){var k,h,c,f;"undefined"!==typeof exports?(c=exports,f=require("./predicates").vst.predicates,h=require("./functions").vst.functions):"undefined"!==typeof window?(c=window,f=window.vst.predicates,h=window.vst.functions):(c=this,f=this.vst.predicates,h=this.vst.functions);k=function(){function c(a,d,g){this.compare=a;this.heap=null!=d?d:[];this.length=null!=g?g:this.heap.length;h.assert(f.is_array(this.heap));h.assert(f.is_bounded(0,this.heap.length)(this.length));h.assert(f.is_function(this.compare));
this._build()}c.prototype._parent=function(a){return 0<a?(a+1>>1)-1:0};c.prototype._left_child=function(a){return(a<<1)+1};c.prototype._right_child=function(a){return(a<<1)+2};c.prototype._heapify=function(a){var d,g,c;g=this._left_child(a);c=this._right_child(a);d=this.heap;g=g<this.length&&0<this.compare(d[g],d[a])?g:a;c<this.length&&0<this.compare(d[c],d[g])&&(g=c);g!==a&&(c=d[a],d[a]=d[g],d[g]=c,this._heapify(g));return null};c.prototype._build=function(){var a;for(a=this.length>>1;0<=a;)this._heapify(a),
a-=1;return null};c.prototype.increase_key=function(a,d){var c,f,m,b,e;c=this.compare;f=this.heap;if(0>c(d,f[a]))throw Error("Expected "+d+" to be at least heap["+a+"] = "+f[a]);f[a]=d;b=this._parent;for(m=b(a);a&&0>c(f[m],f[a]);)e=f[a],f[a]=f[m],f[m]=e,a=m,m=b(a);return null};c.prototype.sort=function(){var a,d,c;this._build();d=this.length-1;for(a=this.heap;0<=d;)c=a[0],a[0]=a[d],a[d]=c,this.length-=1,this._heapify(0),d-=1;return null};c.prototype.peek=function(){return this.length?this.heap[0]:
null};c.prototype.pop=function(){var a,d;return this.length?(a=this.heap,d=a[0],a[0]=a[this.length-1],this.length-=1,this._heapify(0),d):null};c.prototype.push=function(a){var d,c,f,m,b;f=this.length;this.length+=1;b=this._parent;m=b(f);c=this.heap;for(d=this.compare;0<f&&0>d(c[m],a);)c[f]=c[m],f=m,m=b(f);c[f]=a;return null};c.prototype.clear=function(){this.length=this.heap.length=0;return null};return c}();c.vst||(c.vst={});c.vst.MaxHeap=k}).call(this);
(function(){var k,h,c,f,p,a,d,g,q,m,b,e={}.hasOwnProperty,l=function(b,a){function d(){this.constructor=b}for(var l in a)e.call(a,l)&&(b[l]=a[l]);d.prototype=a.prototype;b.prototype=new d;b.__super__=a.prototype;return b},t=[].slice;"undefined"!==typeof exports?(q=exports,k=require("./entity").vst.Entity,b=require("./predicates").vst.predicates,g=require("./functions").vst.functions):"undefined"!==typeof window?(q=window,k=window.vst.Entity,b=window.vst.predicates,g=windwow.vst.functions):(q=this,
k=this.vst.Entity,b=this.vst.predicates,g=this.vst.functions);c=function(e){function c(){return c.__super__.constructor.apply(this,arguments)}l(c,e);c.prototype.Iterator=function(b){null==b&&(b=[]);if(this.constructor===c)throw Error("vst.Iterator should not be instantiated directly");if(0===b.length)throw Error("You must specify the subtype as an array to this constructor");b.push(c);return c.__super__.Iterator.call(this,b)};c.prototype.has_next=function(){this.advance();return null!==this.next_element()};
c.prototype.peek=function(){this.advance();return this.next_element()};c.prototype.next=function(){var b;this.advance();b=this.next_element();this.next_element(null);return b};c.prototype.to_array=function(){var b;for(b=[];this.has_next();)b.push(this.next());return b};c.prototype.mapref=function(){var b,e;e=arguments[0];b=2<=arguments.length?t.call(arguments,1):[];return this.map(function(){return this[e].apply(this,b)})};c.prototype.map=function(b){return f.of(this,b)};c.prototype.each=function(e){var a,
d;g.assert(b.is_function(e));for(d=0;this.has_next();){a=this.next();if(!1===e.call(a,a,d))return!1;d+=1}return!0};c.prototype.select=function(b){return p.of(this,b)};c.prototype.exclude=function(b){return h.of(this,b)};c.prototype.take=function(b){return a.of(this,b)};c.prototype.take_while=function(b){return d.of(this,b)};c.prototype.drop=function(e){var a;g.assert(b.is_non_negative_number(e));for(a=-1;(a+=1)<e&&this.has_next();)this.next();return this};c.prototype.drop_while=function(e){var a;
g.assert(b.is_function(e));for(a=-1;(a+=1)<n&&this.has_next()&&e.call(this.peek(),this.peek());)this.next();return this};return c}(k);k.def_abstract_methods(c,{advance:{arity:0}});k.def_properties(c,{next_element:{initial_value:null,is_valid:b.tautology}});m=b.is_instance(c);f=function(e){function a(e){null==e&&(e=[]);g.assert(b.is_array(e));e.push(a);a.__super__.constructor.call(this,e)}l(a,e);a.of=function(b,e){return(new a).iterator(b).fn(e)};a.prototype.advance=function(){var b;null===this.next_element()&&
this.iterator().has_next()&&(b=this.iterator().next(),this.next_element(this.fn().call(b,b,this.i())),this.i(1+this.i()));return!0};return a}(c);k.def_properties(f,{iterator:{is_valid:m},fn:{is_valid:b.is_function},i:{is_valid:b.is_non_negative_number,initial_value:0}});k.def_toString(f);a=function(e){function a(e){null==e&&(e=[]);g.assert(b.is_array(e));e.push(a);a.__super__.constructor.call(this,e)}l(a,e);a.of=function(b,e){return(new a).iterator(b).n(e)};a.prototype.advance=function(){null===this.next_element()&&
this.i()<this.n()&&this.next_element(this.iterator().next());return!0};return a}(c);k.def_properties(a,{iterator:{is_valid:m},n:{is_valid:b.is_non_negative_number},i:{is_valid:b.is_non_negative_number,initial_value:0}});k.def_toString(a);d=function(e){function a(e){null==e&&(e=[]);g.assert(b.is_array(e));e.push(a);a.__super__.constructor.call(this,e)}l(a,e);a.of=function(b,e){return(new a).iterator(b).n(e)};a.prototype.advance=function(){var b;null===this.next_element()&&this.iterator().has_next()&&
(b=this.iterator().peek(),this.is_valid().call(b,b)&&this.next_element(this.iterator().next()));return!0};return a}(c);k.def_properties(d,{iterator:{is_valid:m},is_valid:{is_valid:b.is_function}});k.def_toString(d);p=function(e){function a(e){null==e&&(e=[]);g.assert(b.is_array(e));e.push(a);a.__super__.constructor.call(this,e)}l(a,e);a.of=function(b,e){return(new a).iterator(b).is_valid(e)};a.prototype.advance=function(){var b;if(null===this.next_element()){for(b=this.iterator().next();b&&!1===this.is_valid().call(b,
b);)b=this.iterator().next();this.next_element(b)}return!0};return a}(c);k.def_properties(p,{iterator:{is_valid:m},is_valid:{is_valid:b.is_function}});k.def_toString(p);h=function(e){function a(e){null==e&&(e=[]);g.assert(b.is_array(e));e.push(a);a.__super__.constructor.call(this,e)}l(a,e);a.of=function(b,e){return(new a).iterator(b).is_valid(e)};a.prototype.advance=function(){var b;if(null===this.next_element()){for(b=this.iterator().next();b&&!0===this.is_valid().call(b,b);)b=this.iterator().next();
this.next_element(b)}return!0};return a}(c);k.def_properties(h,{iterator:{is_valid:m},is_valid:{is_valid:b.is_function}});k.def_toString(h);q.vst||(q.vst={});q.vst.Iterator=c}).call(this);
(function(){var k,h,c,f,p={}.hasOwnProperty,a=function(a,c){function f(){this.constructor=a}for(var m in c)p.call(c,m)&&(a[m]=c[m]);f.prototype=c.prototype;a.prototype=new f;a.__super__=c.prototype;return a};"undefined"!==typeof exports?(c=exports,k=require("./entity").vst.Entity,f=require("./predicates").vst.predicates,require("./functions")):"undefined"!==typeof window?(c=window,k=window.vst.Entity,f=window.vst.predicates):(c=this,k=this.vst.Entity,f=this.vst.predicates);h=function(d){function c(a){null==
a&&(a=[]);if(this.constructor===c)throw Error("vst.Node should not be instantiated directly");if(0===a.length)throw Error("You must specify the subtype as an array to this constructor");a.push(c);c.__super__.constructor.call(this,a)}a(c,d);c.prototype.is_leaf=function(){return null===this.lesser_child()&&null===this.greater_child()};c.prototype.is_branch=function(){return!!this.lesser_child()^1===!!this.greater_child()};c.prototype.value=function(){if(0===this.values().length)return null;if(1===this.values().length)return this.values()[0];
throw Error("There are multiple values, please use Node::values() instead.");};return c}(k);k.def_properties(h,{key:{is_valid:f.tautology},values:{is_valid:f.is_array,init:function(){return[]}},height:{initial_value:0,is_valid:f.is_non_negative_number},greater_child:{initial_value:null,is_valid:f.disjoin(f.is_null,f.is_instance(h))},lesser_child:{initial_value:null,is_valid:f.disjoin(f.is_null,f.is_instance(h))},greater_neighbor:{initial_value:null,is_valid:f.disjoin(f.is_null,f.is_instance(h)),stringify:!1},
lesser_neighbor:{initial_value:null,is_valid:f.disjoin(f.is_null,f.is_instance(h)),stringify:!1}});f.is_instance(h);c.vst||(c.vst={});c.vst.Node=h}).call(this);
(function(){var k,h,c,f,p,a={}.hasOwnProperty,d=function(c,d){function f(){this.constructor=c}for(var b in d)a.call(d,b)&&(c[b]=d[b]);f.prototype=d.prototype;c.prototype=new f;c.__super__=d.prototype;return c};"undefined"!==typeof exports?(f=exports,k=require("./entity").vst.Entity,h=require("./iterator").vst.Iterator,c=require("./node").vst.Node,p=require("./predicates").vst.predicates):"undefined"!==typeof window?(f=window,k=window.vst.Entity,h=window.vst.Iterator,c=window.vst.Node,p=window.vst.predicates):
(f=this,k=this.vst.Entity,h=this.vst.Iterator,c=this.vst.Node,p=this.vst.predicates);h=function(a){function c(a){null==a&&(a=[]);if(!(this instanceof c))return new c(a);a.push(c);c.__super__.constructor.call(this,a)}d(c,a);c.of=function(a,b,e){return(new c).node(a).upper_key(b).comparator(e)};c.empty=function(){return this.of(null,-1,function(a,b){return 1})};c.prototype.advance=function(){null===this.next_element()&&this.node()&&0>=this.comparator()(this.node().key(),this.upper_key())&&(this.next_element(this.node()),
this.node(this.node().greater_neighbor()));return!0};return c}(h);k.def_properties(h,{comparator:{is_valid:p.conjoin(p.is_function,p.has_arity(2))},node:{is_valid:p.disjoin(p.is_null,p.is_instance(c))},upper_key:{is_valid:p.tautology}});k.def_toString(h);f.vst||(f.vst={});f.vst.RangeIterator=h}).call(this);
(function(){var k,h,c,f,p,a,d,g={}.hasOwnProperty,q=function(a,b){function e(){this.constructor=a}for(var c in b)g.call(b,c)&&(a[c]=b[c]);e.prototype=b.prototype;a.prototype=new e;a.__super__=b.prototype;return a};"undefined"!==typeof exports?(a=exports,k=require("./entity").vst.Entity,h=require("./iterator").vst.Iterator,c=require("./node").vst.Node,d=require("./predicates").vst.predicates,f=require("./functions").vst.functions):"undefined"!==typeof window?(a=window,k=window.vst.Entity,h=window.vst.Iterator,
c=window.vst.Node,d=window.vst.predicates,f=windwow.vst.functions):(a=this,k=this.vst.Entity,h=this.vst.Iterator,c=this.vst.Node,d=this.vst.predicates,f=this.vst.functions);p=function(a,b,e){var c,d,f,g,h;h=b.lesser_neighbor();for(g=b.greater_neighbor();;)if(h)if(g)if(c=e(b.key(),a),d=e(h.key(),a),f=e(g.key(),a),d<c)f<d?(b=g,g=g.greater_neighbor()):(b=h,h=h.lesser_neighbor());else if(f<c)b=g,g=g.greater_neighbor();else return b;else if(e(h.key(),a)<e(b.key(),a))b=h,h=h.lesser_neighbor();else return b;
else if(g)if(e(g.key(),a)<e(b.key(),a))b=g,g=g.greater_neighbor();else return b;else return b};h=function(a){function b(a){null==a&&(a=[]);f.assert(d.is_array(a));a.push(b);b.__super__.constructor.call(this,a)}q(b,a);b.of=function(a,l,g,h){f.assert(a instanceof c);f.assert(d.is_defined(l));f.assert(d.is_non_negative_number(g));f.assert(d.is_function(h));a=p(l,a,h);l=(new b).distance(h).key(l).k(g);0<g&&l.next_element(a).greater_neighbor(a.greater_neighbor()).lesser_neighbor(a.lesser_neighbor()).i(1);
return l};b.empty=function(){return(new b).neighbors([])};b.prototype.advance=function(){var b,a;null===this.next_element()&&this.i()<this.k()&&(this.lesser_neighbor()?(this.greater_neighbor()?(a=this.distance()(this.lesser_neighbor().key(),this.key()),b=this.distance()(this.greater_neighbor().key(),this.key()),a<b?(this.next_element(this.lesser_neighbor()),this.lesser_neighbor(this.lesser_neighbor().lesser_neighbor())):(this.next_element(this.greater_neighbor()),this.greater_neighbor(this.greater_neighbor().greater_neighbor()))):
(this.next_element(this.lesser_neighbor()),this.lesser_neighbor(this.lesser_neighbor().lesser_neighbor())),this.i(1+this.i())):this.greater_neighbor()&&(this.next_element(this.greater_neighbor()),this.greater_neighbor(this.greater_neighbor().greater_neighbor()),this.i(1+this.i())));return!0};return b}(h);k.def_properties(h,{node:{is_valid:d.is_instance(c)},lesser_neighbor:{is_valid:d.disjoin(d.is_instance(c),d.is_null)},greater_neighbor:{is_valid:d.disjoin(d.is_instance(c),d.is_null)},key:{is_valid:d.is_defined},
k:{is_valid:d.is_non_negative_number},i:{is_valid:d.is_non_negative_number,initial_value:0},distance:{is_valid:d.is_function}});k.def_toString(h);a.vst||(a.vst={});a.vst.NearestNeighborIterator=h}).call(this);
(function(){var k,h,c,f,p,a,d,g,q={}.hasOwnProperty,m=function(b,a){function c(){this.constructor=b}for(var d in a)q.call(a,d)&&(b[d]=a[d]);c.prototype=a.prototype;b.prototype=new c;b.__super__=a.prototype;return b};"undefined"!==typeof exports?(d=exports,k=require("./entity").vst.Entity,c=require("./node").vst.Node,f=require("./range_iterator").vst.RangeIterator,h=require("./nearest_neighbor_iterator").vst.NearestNeighborIterator,require("./max_heap"),g=require("./predicates").vst.predicates,a=require("./functions").vst.functions):
"undefined"!==typeof window?(d=window,k=window.vst.Entity,c=window.vst.Node,f=window.vst.RangeIterator,h=window.vst.NearestNeighborIterator,g=window.vst.predicates,a=window.vst.functions):(d=this,k=this.vst.Entity,c=this.vst.Node,f=this.vst.RangeIterator,h=this.vst.NearestNeighborIterator,g=this.vst.predicates,a=this.vst.functions);p=function(b){function e(b){null==b&&(b=[]);if(this.constructor===e)throw Error("vst.Tree should not be instantiated directly");if(0===b.length)throw Error("You must specify the subtype as an array to this constructor");
b.push(e);e.__super__.constructor.call(this,b)}m(e,b);e.prototype.is_node_type=function(b){return b instanceof this.NodeType()};e.prototype.assert_is_node_type=function(b){return a.assert(this.is_node_type(b),"Expected "+a.to_string(b)+" to be a "+this.NodeType().name)};e.prototype.height=function(){return g.is_defined(this.root())?this.root().height():0};e.prototype.greatest=function(b){null==b&&(b=this.root());if(null===b)return null;for(this.assert_is_node_type(b);b.greater_child();)b=b.greater_child();
return b};e.prototype.least=function(b){null==b&&(b=this.root());if(null===b)return null;for(this.assert_is_node_type(b);b.lesser_child();)b=b.lesser_child();return b};e.prototype.try_insert=function(b,e){a.assert(g.is_defined(b));return g.is_null(this.root())?(this.root(this.NodeType().of(b,e)),this.size(this.size()+1),!0):!1===this.contains_key(b)?(this.add_descendant(this.root(),this.NodeType().of(b,e)),this.size(this.size()+1),!0):!1};e.prototype.insert=function(b,e){var c;a.assert(g.is_defined(b));
null===this.root()?this.root(this.NodeType().of(b,e)):(c=this.find(b))?c.values().push(e):this.add_descendant(this.root(),this.NodeType().of(b,e));this.size(this.size()+1);return this};e.prototype.contains_key=function(b){a.assert(g.is_defined(b));return null!==this.find(b)};e.prototype.find=function(b){var e,c;a.assert(g.is_defined(b));for(c=this.root();c;)if(e=this.comparator()(b,c.key()),0<e)c=c.greater_child();else if(0>e)c=c.lesser_child();else break;return c};e.prototype.find_nearest=function(b){var e,
c;a.assert(g.is_defined(b));for(c=this.root();c;)if(e=this.comparator()(b,c.key()),0<e){if(null===c.greater_child())break;c=c.greater_child()}else if(0>e){if(null===c.lesser_child())break;c=c.lesser_child()}else break;return c};e.prototype.find_nearest_gte=function(b){var e;a.assert(g.is_defined(b));for(e=this.find_nearest(b);e&&0>this.comparator()(e.key(),b);)e=e.greater_neighbor();return e};e.prototype.find_nearest_lte=function(b){var e;a.assert(g.is_defined(b));for(e=this.find_nearest(b);e&&0<
this.comparator()(e.key(),b);)e=e.lesser_neighbor();return e};e.prototype.remove=function(b,e){var c,d,f,h,m,k;a.assert(g.is_defined(b));if(f=this.find(b)){if(g.is_defined(e)){k=f.values();d=h=0;for(m=k.length;h<m;d=++h)if(c=k[d],c===e)return f.values().splice(d,1),0===f.values().length&&this.remove_node(f),this.size(this.size()-1),!0;return!1}this.size(this.size()-f.values().length);this.remove_node(f);return!0}return!1};e.prototype.preorder=function(b,a){null==a&&(a=this.root());a&&(b(a),a.lesser_child()&&
this.preorder(b,a.lesser_child()),a.greater_child()&&this.preorder(b,a.greater_child()));return this};e.prototype.inorder=function(b,a){null==a&&(a=this.root());a&&(a.lesser_child()&&this.inorder(b,a.lesser_child()),b(a),a.greater_child()&&this.inorder(b,a.greater_child()));return this};e.prototype.postorder=function(b,a){null==a&&(a=this.root());a&&(a.lesser_child()&&this.postorder(b,a.lesser_child()),a.greater_child()&&this.postorder(b,a.greater_child()),b(a));return this};e.prototype.range=function(b,
e){var c;a.assert(0>=this.comparator()(b,e),"Expected lower:"+a.to_string(b)+" <= upper:"+a.to_string(e));c=this.find_nearest_gte(b);return f.of(c,e,this.comparator())};e.prototype.neighbors=function(b,e,c){var d,h,k;a.assert(g.is_defined(b));a.assert(g.is_non_negative_number(e));a.assert(g.is_non_negative_number(c));if(k=this.find_nearest(b)){d=this.comparator()(k.key(),b);if(b=0>d?k:k.lesser_neighbor())for(h=1;h<e&&b.lesser_neighbor();)b=b.lesser_neighbor(),h+=1;if(e=0<d?k:k.greater_neighbor())for(h=
1;h<c&&e.greater_neighbor();)e=e.greater_neighbor(),h+=1;c=b||k;k=(null!=e?e.key():void 0)||k.key();return f.of(c,k,this.comparator())}return f.empty()};e.prototype.nearest_neighbors=function(b,e,c){var d;a.assert(g.is_defined(b));a.assert(g.is_non_negative_number(e));a.assert(g.is_function(c)&&2===c.length);return(d=this.find_nearest(b))?h.of(d,b,e,c):h.empty()};return e}(k);k.def_abstract_methods(p,{add_descendant:{arity:2},remove_node:{arity:1}});k.def_properties(p,{comparator:{is_valid:g.disjoin(g.conjoin(g.is_function,
g.has_arity(2)),g.is_undefined)},size:{initial_value:0,is_valid:g.is_non_negative_number},NodeType:{is_valid:g.disjoin(g.is_type(c),g.is_undefined)},root:{initial_value:null,is_valid:g.disjoin(g.is_null,g.conjoin(g.is_instance(c),p.prototype.is_node_type))}});d.vst||(d.vst={});d.vst.Tree=p}).call(this);
(function(){var k,h,c,f,p,a={}.hasOwnProperty,d=function(c,d){function f(){this.constructor=c}for(var b in d)a.call(d,b)&&(c[b]=d[b]);f.prototype=d.prototype;c.prototype=new f;c.__super__=d.prototype;return c};"undefined"!==typeof exports?(c=exports,h=require("./entity").vst.Entity,k=require("./node").vst.Node,p=require("./predicates").vst.predicates,require("./functions")):"undefined"!==typeof window?(c=window,h=window.vst.Entity,k=window.vst.Node,p=window.vst.predicates):(c=this,h=this.vst.Entity,
k=window.vst.Node,p=this.vst.predicates);k=function(a){function c(a){null==a&&(a=[]);if(!(this instanceof c))return new c(a);a.push(c);c.__super__.constructor.call(this,a)}d(c,a);c.of=function(a,b){var e;e=(new c).key(a);e.values().push(b);return e};c.prototype.max_child_height=function(){var a,b;b=this.lesser_child()?this.lesser_child().height():-1;a=this.greater_child()?this.greater_child().height():-1;return Math.max(b,a)};c.prototype.balance=function(){var a,b;b=this.lesser_child()?this.lesser_child().height():
-1;a=this.greater_child()?this.greater_child().height():-1;return b-a};c.prototype.is_balanced=function(){var a;return-1<=(a=this.balance())&&1>=a};return c}(k);f=p.is_instance(k);h.def_properties(k,{parent:{initial_value:null,is_valid:p.disjoin(f,p.is_null),stringify:!1}});h.def_toString(k);c.vst||(c.vst={});c.vst.AvlNode=k}).call(this);
(function(){var k,h,c,f,p,a,d={}.hasOwnProperty,g=function(a,c){function b(){this.constructor=a}for(var e in c)d.call(c,e)&&(a[e]=c[e]);b.prototype=c.prototype;a.prototype=new b;a.__super__=c.prototype;return a};"undefined"!==typeof exports?(p=exports,c=require("./entity").vst.Entity,k=require("./avl_node").vst.AvlNode,h=require("./tree").vst.Tree,a=require("./predicates").vst.predicates,f=require("./functions").vst.functions):"undefined"!==typeof window?(p=window,c=window.vst.Entity,k=window.vst.AvlNode,
h=window.vst.Tree,a=window.vst.predicates,f=window.vst.functions):(p=this,c=this.vst.Entity,k=this.vst.AvlNode,h=this.vst.Tree,a=this.vst.predicates,f=this.vst.functions);h=function(c){function d(b){null==b&&(b=[]);if(!(this instanceof d))return new d(b);b.push(d);d.__super__.constructor.call(this,b)}g(d,c);d.of=function(b){return(new d).NodeType(k).comparator(b)};d.prototype.greater_greater_case=function(b){var a;this.assert_is_node_type(b);f=b.parent();a=b.greater_child();a.greater_child();b.greater_child(a.lesser_child());
b.greater_child()&&b.greater_child().parent(b);a.lesser_child(b);b.parent(a);f?(f.greater_child()===b?f.greater_child(a):f.lesser_child(a),a.parent(f)):(a.parent(null),this.root(a));this.recompute_heights(b);this.recompute_heights(a.parent());return this};d.prototype.greater_lesser_case=function(b){var a,c;this.assert_is_node_type(b);f=b.parent();a=b.greater_child();c=a.lesser_child();a.lesser_child(c.greater_child());a.lesser_child()&&a.lesser_child().parent(a);b.greater_child(c.lesser_child());
b.greater_child()&&b.greater_child().parent(b);c.greater_child(a);a.parent(c);c.lesser_child(b);b.parent(c);f?(f.greater_child()===b?f.greater_child(c):f.lesser_child(c),c.parent(f)):(c.parent(null),this.root(c));this.recompute_heights(b);this.recompute_heights(a);return this};d.prototype.lesser_lesser_case=function(b){var a;this.assert_is_node_type(b);f=b.parent();a=b.lesser_child();a.lesser_child();b.lesser_child(a.greater_child());b.lesser_child()&&b.lesser_child().parent(b);a.greater_child(b);
b.parent(a);f?(f.greater_child()===b?f.greater_child(a):f.lesser_child(a),a.parent(f)):(a.parent(null),this.root(a));this.recompute_heights(b);this.recompute_heights(a.parent());return this};d.prototype.lesser_greater_case=function(b){var a,c;this.assert_is_node_type(b);f=b.parent();a=b.lesser_child();c=a.greater_child();b.lesser_child(c.greater_child());b.lesser_child()&&b.lesser_child().parent(b);a.greater_child(c.lesser_child());a.greater_child()&&a.greater_child().parent(a);c.lesser_child(a);
a.parent(c);c.greater_child(b);b.parent(c);f?(f.greater_child()===b?f.greater_child(c):f.lesser_child(c),c.parent(f)):(c.parent(null),this.root(c));this.recompute_heights(b);this.recompute_heights(a);return this};d.prototype.rebalance=function(b){var a;this.assert_is_node_type(b);a=b.balance();-2>=a?0>=b.greater_child().balance()?this.greater_greater_case(b):this.greater_lesser_case(b):2<=a&&(0<=b.lesser_child().balance()?this.lesser_lesser_case(b):this.lesser_greater_case(b));return this};d.prototype.recompute_heights=
function(b){var c;if(a.is_defined(b))for(this.assert_is_node_type(b),c=!0;b&&c;)c=b.height(),b.height(b.greater_child()||b.lesser_child()?1+b.max_child_height():0),c=b.height!==c,b=b.parent();return this};d.prototype.add_descendant=function(b,a){var c,d;this.assert_is_node_type(b);this.assert_is_node_type(a);d=this.comparator()(a.key(),b.key());c=null;0>d?c=this.add_lesser_child(b,a):0<d?c=this.add_greater_child(b,a):this.add_equivalent_child(a);c&&this.rebalance(c);return this};d.prototype.add_lesser_child=
function(b,a){var c,d;this.assert_is_node_type(b);this.assert_is_node_type(a);a.greater_neighbor(b);c=null;if(b.lesser_child())this.add_descendant(b.lesser_child(),a);else if(b.lesser_child(a),a.parent(b),b.lesser_neighbor()&&b.lesser_neighbor().greater_neighbor(a),b.lesser_neighbor(a),0===b.height())for(d=b;d;){d.height(1+d.max_child_height());if(!d.is_balanced()){c=d;break}d=d.parent()}return c};d.prototype.add_greater_child=function(b,a){var c,d;this.assert_is_node_type(b);this.assert_is_node_type(a);
a.lesser_neighbor(b);c=null;if(b.greater_child())this.add_descendant(b.greater_child(),a);else if(b.greater_child(a),a.parent(b),b.greater_neighbor()&&b.greater_neighbor().lesser_neighbor(a),b.greater_neighbor(a),0===b.height())for(d=b;d;){d.height(1+d.max_child_height());if(!d.is_balanced()){c=d;break}d=d.parent()}return c};d.prototype.add_equivalent_child=function(b,a){this.assert_is_node_type(b);this.assert_is_node_type(a);b.values(b.values().concat(a.values()));a.lesser_neighbor(null);a.greater_neighbor(null);
a.lesser_child(null);a.greater_child(null);a.values().length=0;a.parent(null);return null};d.prototype.remove_node=function(b){this.assert_is_node_type(b);b.values().length=0;b.lesser_neighbor()&&b.lesser_neighbor(b.greater_neighbor());b.greater_neighbor()&&b.greater_neighbor(b.lesser_neighbor());b.is_leaf()?this.remove_leaf(b):b.is_branch()?this.remove_branch(b):this.swap_and_remove(b);return this};d.prototype.remove_leaf=function(b){var a;this.assert_is_node_type(b);if(a=b.parent())for(a.lesser_child()===
b?a.lesser_child(null):a.greater_child(null),this.recompute_heights(a);b=b.parent();)b.is_balanced()||this.rebalance(b);else this.root(null);return null};d.prototype.remove_branch=function(b){var a;this.assert_is_node_type(b);if(a=b.parent())for(a.lesser_child()?a.lesser_child(b.greater_child()||b.lesser_child()):a.greater_child(b.greater_child()||b.lesser_child()),b.greater_child()?b.greater_child().parent(a):b.lesser_child().parent(a),this.recompute_heights(a);b=b.parent();)b.is_balanced()||this.rebalance(b);
return null};d.prototype.swap_and_remove=function(b){var a;this.assert_is_node_type(b);a=this.least(b.greater_child());this.swap_nodes(b,a);0===b.height()?this.remove_leaf(b):this.remove_branch(b);return null};d.prototype.swap_nodes=function(b,a){var c,d,f,g,h,k,m;this.assert_is_node_type(b);this.assert_is_node_type(a);k=b.parent();g=b.lesser_child();c=b.greater_child();m=a.parent();h=a.lesser_child();d=a.greater_child();f=b.height();b.height(a.height());a.height(f);k?(k.lesser_child()===b?parent.lesser_child(a):
parent.greater_child(a),a.parent(parent)):(a.parent(null),this.root(a));a.lesser_child(g);g.parent(a);b.lesser_child(h);h.parent(b);d?d.parent(b):m!==b?(a.greater_child(c),c.parent(a),m.lesser_child(b),b.parent(m)):(a.greater_child(b),b.parent(a));return null};return d}(h);c.def_toString(h);p.vst||(p.vst={});p.vst.AvlTree=h}).call(this);
